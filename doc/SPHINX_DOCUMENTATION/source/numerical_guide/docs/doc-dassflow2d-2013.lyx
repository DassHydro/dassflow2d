#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\begin_preamble
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{color}

\usepackage[affil-it]{authblk}

%\usepackage{indentfirst}

\author[1]{Frédéric Couderc\thanks{frederic.couderc@math.univ-toulouse.fr}}
\author[2]{Ronan Madec}
\author[2]{Jerôme Monnier\thanks{jerome.monnier@insa-toulouse.fr}}
\author[2]{Jean-Paul Vila}
\affil[1]{CNRS, the Toulouse Mathematics Institute, Toulouse University.}
\affil[2]{INSA, the Toulouse Mathematics Institute, Toulouse University.}

\renewcommand\Authands{ and }

\newcommand{\version}{v2.00.00}
\newcommand{\DassFlow}{\textsc{DassFlow}}

\newcommand{\bin}{\texttt{\textbf{/bin}}}
\newcommand{\cpp}{\texttt{\textbf{/cpp}}}
\newcommand{\doc}{\texttt{\textbf{/doc}}}
\newcommand{\libs}{\texttt{\textbf{/libs}}}
\newcommand{\obj}{\texttt{\textbf{/obj}}}
\newcommand{\simu}{\texttt{\textbf{/simu}}}
\newcommand{\souk}{\texttt{\textbf{/souk}}}
\newcommand{\src}{\texttt{\textbf{/src}}}
\newcommand{\tap}{\texttt{\textbf{/tap}}}
\newcommand{\test}{\texttt{\textbf{/test}}}

\newcommand{\binres}{\texttt{\textbf{/bin/res}}}
\newcommand{\binmsh}{\texttt{\textbf{/bin/msh}}}
\newcommand{\binobs}{\texttt{\textbf{/bin/obs}}}
\newcommand{\bingrad}{\texttt{\textbf{/bin/grad}}}
\newcommand{\binmin}{\texttt{\textbf{/bin/min}}}

\newcommand{\make}{\texttt{\textbf{Makefile}}}
\newcommand{\exe}{\texttt{\textbf{exe}}}

\newcommand{\inp}{\texttt{\textbf{input.txt}}}
\newcommand{\usr}{\texttt{\textbf{m\_user\_data.f90}}}
\newcommand{\tst}{\texttt{\textbf{m\_user\_test.f90}}}
\newcommand{\bc}{\texttt{\textbf{bc.txt}}}
\newcommand{\obs}{\texttt{\textbf{obs.txt}}}
\newcommand{\paramObs}{\texttt{\textbf{param\_obs.txt}}}
\newcommand{\hydro}{\texttt{\textbf{hydrograph.txt}}}
\newcommand{\rat}{\texttt{\textbf{ratcurve.txt}}}
\newcommand{\landuse}{\texttt{\textbf{land\_use.txt}}}

\newcommand{\warm}{\includegraphics[scale=0.25]{figs/Symbols-Critical-icon}}

\lhead{\DassFlow{} \version{} - User and Developer Guide}
\rhead{CNRS/IMT/INSA/Toulouse University}
\cfoot{\thepage/\pageref{LastPage}}
\pagestyle{fancy}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lightrulewidth=.04em
\heavyrulewidth=.12em
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "lmodern" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement !tbh
\paperfontsize 10
\spacing single
\use_hyperref true
\pdf_title "DassFlow 2 : User and Developer Guide"
\pdf_author "Frederic Couderc"
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks true
\pdf_backref false
\pdf_pdfusetitle true
\papersize a4paper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 2cm
\rightmargin 2cm
\bottommargin 2cm
\headheight 1cm
\headsep 1cm
\footskip 1cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 2
\paperpagestyle fancy
\bullet 1 0 15 -1
\bullet 2 0 0 -1
\bullet 3 0 6 -1
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Itemize
\begin_inset Graphics
	filename figs/logo-cnrs.svg
	lyxscale 15
	height 2cm

\end_inset


\begin_inset space \hspace{}
\length 0.5cm
\end_inset


\begin_inset Graphics
	filename figs/logo-IMT.png
	lyxscale 20
	height 2cm

\end_inset


\begin_inset space \hspace{}
\length 0.5cm
\end_inset


\begin_inset Graphics
	filename figs/logo-insa.svg
	height 2cm

\end_inset


\begin_inset space \hspace{}
\length 0.5cm
\end_inset


\begin_inset Graphics
	filename figs/logo-univ-toulouse.svg
	lyxscale 40
	height 2cm

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset VSpace 1.2cm
\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{} 
\backslash
version{}
\end_layout

\end_inset

 : User and Developer Guide
\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Presentation
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 is a free computational sotfware framework initially dedicated to river
 hydraulic simulation and especially designed for variational data assimilation
 (4D-VAR).
 All source files are written in Fortran 2003.
\end_layout

\begin_layout Standard
The first forward model is based on the bidimensional Shallow Water (or
 Saint-Venant) equations of conservation considering both bed elevation
 and Manning-Strickler friction source terms.
 The conservative variables are the water depth 
\begin_inset Formula $h$
\end_inset

 and the local discharge 
\begin_inset Formula $\mathbf{q}=h\mathbf{u}$
\end_inset

, where 
\begin_inset Formula $\mathbf{u}=(u,v)^{T}$
\end_inset

 is the depth-averaged velocity vector.
 On a computational domain 
\begin_inset Formula $\Omega\in\mathbb{\mathbb{\mathbb{R}}}^{2}$
\end_inset

 and for a time interval 
\begin_inset Formula $\left[0,T\right]$
\end_inset

, the equations numerically resolved are,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{lclcc}
\partial_{t}h+div(\mathbf{q}) & = & 0 & \textrm{in} & \text{Ω}\times]0,T]\\
\\
\partial_{t}\mathbf{q}+div\left(\dfrac{\mathbf{q}\otimes\mathbf{q}}{h}+g\dfrac{h^{2}}{2}\right) & = & -gh\mathbf{\nabla}z_{b}-g\dfrac{n^{2}\left\Vert \mathbf{q}\right\Vert }{h^{7/3}}\mathbf{q} & \textrm{in} & \text{Ω}\times]0,T]
\end{array}\right.\label{eq:sw}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with provided initial and boundary conditions.
 
\begin_inset Formula $g$
\end_inset

 is the magnitude of the gravity, 
\begin_inset Formula $z_{b}$
\end_inset

 the bed elevation and 
\begin_inset Formula $n$
\end_inset

 the Manning-Strickler roughness coefficient.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/sw.pdf
	lyxscale 40
	width 25text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Shallow water equations variables sketch
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The model is numerically resolved by a Finite Volume method considering
 either structured or unstructured grids of discretization of the computational
 domain.
 Several numerical schemes have been implemented and give the possibility
 to use a globally first or second order numerical solver with the well-balanced
 property.
 The global stability and robustness of the schemes insure a good treatment
 of dynamic wet/dry fronts without a water depth cut-off.
 Different types of boundary conditions can be prescribed at user-defined
 subsets of the computational domain to consider walls, inflows or outflows.
\end_layout

\begin_layout Standard
The adjoint code is completely automatically generated using the differentiation
 tool Tapenade 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www-sop.inria.fr/tropics/"
literal "false"

\end_inset


\end_layout

\end_inset

 and some final tricks.
 It can be used to perform a sensibility analysis or an identification process
 by calculating the gradient of a cost function defined using for example
 stations or wet sections of observation.
\end_layout

\begin_layout Standard
The forward as the adjoint discrete models can be runned in parallel calling
 the MPI library.
\end_layout

\begin_layout Subsection
License
\end_layout

\begin_layout Standard
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software is distributed under the CeCILL 
\begin_inset Foot
status open

\begin_layout Plain Layout
Ce(A)C(nrs)I(NRIA)L(ogiciel)L(ibre), 
\begin_inset CommandInset href
LatexCommand href
target "http://www.cecill.info/"
literal "false"

\end_inset


\end_layout

\end_inset

 license in version 2 compatible with the GNU GPL license.
\end_layout

\begin_layout Standard
List of the external librairies that are eventually used by the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software:
\end_layout

\begin_layout Itemize

\series bold
Scotch 
\series default

\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "https://gforge.inria.fr/projects/scotch/"
literal "false"

\end_inset


\end_layout

\end_inset


\series bold
 :
\series default
 a software package for graph and mesh/hypergraph partitioning, graph clustering
, and sparse matrix ordering available as free software under the CeCILL-C
 license.
\end_layout

\begin_layout Itemize

\series bold
Mpich 
\series default

\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.mpich.org/"
literal "false"

\end_inset


\end_layout

\end_inset


\series bold
 :
\series default
 a high performance and widely portable implementation of the Message Passing
 Interface (MPI) standard available as free software.
\end_layout

\begin_layout Itemize

\series bold
Tapenade
\series default
 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www-sop.inria.fr/tropics/"
literal "false"

\end_inset


\end_layout

\end_inset

 : External executable Java program that is called to generate the discrete
 model adjoint.
 Free of use in an academic usage.
\end_layout

\begin_layout Itemize

\series bold
m1qn3 
\series default

\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "https://who.rocq.inria.fr/Jean-Charles.Gilbert/modulopt/optimization-routines/m1qn3/m1qn3.html"
literal "false"

\end_inset


\end_layout

\end_inset


\series bold
 :
\series default
 a solver of large-scale unconstrained minimization problems ditributed
 under the GNU General Public License and listed in the Free Software Directory.
\end_layout

\begin_layout Itemize

\series bold
Mumps 
\series default

\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://graal.ens-lyon.fr/MUMPS/"
literal "false"

\end_inset


\end_layout

\end_inset


\series bold
 :
\series default
 a parallel sparse direct solver avaible in public domain, based on public
 domain software developed during the Esprit IV European project PARASOL
 (1996-1999).
\end_layout

\begin_layout Subsection
System requirements
\end_layout

\begin_layout Standard
One particularity of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software is that you need to compile if you want to use it.
 The main reason is that some inputs are defined by some 
\shape italic
"user-functions"
\shape default
 which are part of the Fortran code, so we need to recompile the code every
 time we change one of them.
\end_layout

\begin_layout Standard
In this document, we will assume that you have a Linux or Unix operating
 system even if compilation remains possible on Windows (using Cygwin 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
name "http://www.cygwin.com/"
target "http://www.cygwin.com/"
literal "false"

\end_inset


\end_layout

\end_inset

 for example) and MacOS (native Linux) operating systems.
 One of these two compilers must be installed,
\end_layout

\begin_layout Itemize
the GNU Fortran compiler 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://gcc.gnu.org/fortran/"
literal "false"

\end_inset


\end_layout

\end_inset

 (free software under the GPL free license).
\end_layout

\begin_layout Itemize
the INTEL Fotran compiler 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://software.intel.com/en-us/intel-compilers"
literal "false"

\end_inset


\end_layout

\end_inset

 (commercial software under a proprietary license).
\end_layout

\begin_layout Standard
Result output files are written in the following formats,
\end_layout

\begin_layout Itemize
text format (
\family typewriter
.txt
\family default
 extension) : a basic format file that can generally be plotted with your
 favorite graphical XY-plot software 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://en.wikipedia.org/wiki/List_of_graphing_software"
literal "false"

\end_inset


\end_layout

\end_inset

, like the Gnuplot 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.gnuplot.info/"
literal "false"

\end_inset


\end_layout

\end_inset

 free software.
\end_layout

\begin_layout Itemize
VTK format (
\family typewriter
.vtk
\family default
 extension) : the Kitware free format file 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.vtk.org/"
literal "false"

\end_inset


\end_layout

\end_inset

 that can be read by visualization free softwares like Paraview 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.paraview.org/"
literal "false"

\end_inset


\end_layout

\end_inset

, Visit 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "https://wci.llnl.gov/codes/visit/"
literal "false"

\end_inset


\end_layout

\end_inset

 or Mayavi 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://code.enthought.com/projects/mayavi/#Mayavi"
literal "false"

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Itemize
Tecplot format (
\family typewriter
.plt
\family default
 extension) : a proprietary format file used by the visualization commercial
 software Tecplot 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.tecplot.com/"
literal "false"

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
and gives the choice of the visulization software(s) to be used.
\end_layout

\begin_layout Subsection
Directories organization
\end_layout

\begin_layout Standard
At the root of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 distribution or archive, one can find the directories Fig.(
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Directories-at-root"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/Directories_at_root.png
	lyxscale 50
	scale 25

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Directories at root
\begin_inset CommandInset label
LatexCommand label
name "fig:Directories-at-root"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 : the main directory to use the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software.
 First, the simulation control files have to be put in,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file (must be provided) which allows the user to define all variables concernin
g the mesh, numerical and physical parameters and input/output options.
\end_layout

\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file (must be provided) which contains user-subroutines which can be used
 to define initial conditions, boundary conditions, etc ...
\end_layout

\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file which allows the user to assign boundary conditions lo labelled boundaries
 of the mesh.
\end_layout

\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file which allows the user to define some observations to output.
\end_layout

\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file which contains all tabullated hydrographs to imposed at specified
 boundaries.
\end_layout

\begin_layout Itemize
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file which contains all tabullated rat curves to imposed at specified boundarie
s.
\end_layout

\begin_layout Standard
The linked executable 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 is putted in this same directory as all simulation result files (in 
\family typewriter
\series bold
bin/res
\family default
\series default
 directory).
\end_layout

\end_deeper
\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
cpp{}
\end_layout

\end_inset

 : a working directory where are putted the preprocessed Fortran files using
 the 'cpp' command (with same original 
\family typewriter
\series bold
.f90
\family default
\series default
 extension).
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
doc{}
\end_layout

\end_inset

 : documention of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
libs{}
\end_layout

\end_inset

 : external libraries eventually compiled (normally automated with the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

) and used by the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software.
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obj{}
\end_layout

\end_inset

 : a working directory where are putted the compiled Fortran files (with
 
\family typewriter
\series bold
.o
\family default
\series default
 extension).
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
simu{}
\end_layout

\end_inset

 : a directory containing all preconfigured simulations.
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
souk{}
\end_layout

\end_inset

 : a directory containing some usefull programs to user and developer.
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
src{}
\end_layout

\end_inset

 : a directory containing all Fortran source files.
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tap{}
\end_layout

\end_inset

 : a directory containing all Tapenade automatically generated Fortran source
 files related to the generation of the adjoint solver.
\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
test{}
\end_layout

\end_inset

 : a directory containing testing cases with a 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tst{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Compilation and Execution
\end_layout

\begin_layout Standard
The compilation process is automated using a 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "https://www.gnu.org/software/make"
literal "false"

\end_inset

, GNU Make.
\end_layout

\end_inset

.
 Some user-defined variables at the header of the file control the software
 parts that have to be compiled as the linked external librairies.
 These options are described in the next paragraph.
 The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

 can also control the execution of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software even if it is not mandatory.
 This will be explained in the second paragraph.
\end_layout

\begin_layout Subsection
Options in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The following variables at the header of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

 allow to control the compilation of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software according to the functionalities desired,
\end_layout

\begin_layout Itemize
<
\family typewriter
COMPILO
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' the GNU Fortran compiler is called ('
\family typewriter
gfortran
\family default
' command).
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' the INTEL Fortran compiler is called ('
\family typewriter
ifort
\family default
' command).
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
OPTIM
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' set the compilation options in debug mode (for developers to check bugs).
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' set the compilation options in optimization mode implying a faster execution
 (that users should use).
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
MODEL
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' a developer mode using the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tst{}
\end_layout

\end_inset

 file placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory that can be used to test the Fortran MODULE structures implemented.
 Some examples can be found in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
test{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' the Shallow Water model is called.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
ADJOINT
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
1
\family default
' adjoint files needed to be generated to compile and link the executable.
\end_layout

\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
MPI
\family default
> : 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
1
\family default
' the MPI library is used to run the program in parallel.
 The compiler command (
\family typewriter
gfortran
\family default
 or 
\family typewriter
ifort
\family default
) is replaced by the 
\family typewriter
mpif90
\family default
 wrapper command.
 The 
\series bold
Scotch
\series default
 library must be compile.
\end_layout

\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
NB_PROC
\family default
> : number of processes called in order to run the software.
\end_layout

\begin_layout Itemize
<
\family typewriter
SOLVER
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
1
\family default
' the 
\series bold
Mumps
\series default
 library is compiled to be linked to the executable.
\end_layout

\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
VALID
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
1
\family default
' the user must provide the exact solution in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file in order to produce relative error norms and exact output result files.
\end_layout

\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\end_deeper
\begin_layout Subsection
Compilation/Execution commands
\end_layout

\begin_layout Standard
Once the functionalities desired have been choosen, one must follow these
 steps at the root of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 distribution,
\end_layout

\begin_layout Itemize
'
\family typewriter
make lib
\family default
' command : compile the external libraries (not necessary if 
\family typewriter
MPI
\family default
=0 and 
\family typewriter
SOLVER
\family default
=0, by default).
\end_layout

\begin_layout Itemize
'
\family typewriter
make tap_files
\family default
' command : generate the discrete adjoint model (not necessary if 
\family typewriter
ADJOINT
\family default
=0, by default).
\end_layout

\begin_layout Itemize
'
\family typewriter
make
\family default
' command : finally compile and link the executable 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory (take care to provide all necessary files in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory with at least 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 files described in the next section).
\end_layout

\begin_layout Standard
If the compilation has successfully achieved, the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 can be runned by the following 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

 commands,
\end_layout

\begin_layout Itemize
'
\family typewriter
make runexe
\family default
' : run the direct model (using <
\family typewriter
NB_PROC
\family default
> threads in parallel mode) equivalent to the './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

' command (or '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> ./
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

' in parallel mode) in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Itemize
'
\family typewriter
make rungrad
\family default
' : run a sensibility analysis equivalent to the './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
grad'
\family default
 command in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory (or '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
grad
\family default
' in parallel mode).
\end_layout

\begin_layout Itemize
'
\family typewriter
make runmin
\family default
' : run a minimization process of the user-defined cost function equivalent
 to the './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 min' command in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory (with '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 min' in parallel mode).
\end_layout

\begin_layout Itemize
'
\family typewriter
make runtestadj
\family default
' : run a test of the generated discrete adjoint model equivalent to the
 './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
testadj
\family default
 0' command in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory (with '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
testadj
\family default
 0' in parallel mode).
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Inputs
\end_layout

\begin_layout Standard
Two main input files must be provided in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory in order to compute a simulation in direct or adjoint modes,
\end_layout

\begin_layout Enumerate
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file
\end_layout

\begin_layout Enumerate
and the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file 
\begin_inset Foot
status open

\begin_layout Plain Layout
alternatively 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tst{}
\end_layout

\end_inset

, as it will be explained later.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
According to the parameters entered in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file, another files must be provided in this same 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Subsection
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:The-inp-file"

\end_inset


\end_layout

\begin_layout Standard
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file contains all physical, numerical and simulation control parameters.
\end_layout

\begin_layout Subsubsection
Mesh parameters
\end_layout

\begin_layout Itemize
<
\family typewriter
mesh_type
\family default
> : type of the mesh desired,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize

\family typewriter
\series bold
'basic'
\family default
\series default
 : structured cartesian mesh.
 The parameters <lx>, <ly>, <nx> and <ny> must be provided.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'dassflow'
\family default
\series default
 : unstructured mesh with an inhouse format 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Inhouse-format"

\end_inset

.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'gmsh'
\family default
\series default
 : unstructured mesh in the Gmsh
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://geuz.org/gmsh/"
literal "false"

\end_inset

, Gmsh: a three-dimensional finite element mesh generator with built-in
 pre- and post-processing facilities
\end_layout

\end_inset

 format 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Gmsh-format"

\end_inset

, a free software distributed under the terms of the GPLv2 license.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
mesh_name
\family default
> : name of the mesh file that must be placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Itemize
<
\family typewriter
lx
\family default
> and <
\family typewriter
ly
\family default
> in [m] : lengths of the computational domain in horizontal x direction
 and vertical y direction.
 By default, the origin 
\begin_inset Formula $\left(0,0\right)$
\end_inset

 is taken at the bottom left.
 It is important for the user-functions defined in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Itemize
<
\family typewriter
nx
\family default
> and <
\family typewriter
ny
\family default
> : number of nodes (and not cells) of the computational domain in respectively
 horizontal x direction and vertical y direction.
\end_layout

\begin_layout Itemize
<
\family typewriter
bc_N
\family default
>, <
\family typewriter
bc_S
\family default
>, <
\family typewriter
bc_W
\family default
> and <
\family typewriter
bc_E
\family default
> : type of the boundary condition at respectively North, South, West and
 East of the computational domain.
\end_layout

\begin_layout Subsubsection
Simulation parameters
\end_layout

\begin_layout Itemize
<
\family typewriter
ts
\family default
> in [s] : total physical simulation time.
\end_layout

\begin_layout Itemize
<
\family typewriter
dtw
\family default
> in [s] : time step to output a result file of all model unknows as some
 inputs according to the switches described in the next section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Output-Results-Files-Switches"

\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
dtp
\family default
> in [s] : time step to output some post-treatment variables.
\end_layout

\begin_layout Itemize
<
\family typewriter
dta
\family default
> in [s] : time step to generate boundary inflow/outflow files in order
 to use the adjoint mode.
\end_layout

\begin_layout Itemize
<
\family typewriter
verbose
\family default
> : level of verbosity at screen.
\end_layout

\begin_layout Subsubsection
Numerical parameters
\end_layout

\begin_layout Itemize
<
\family typewriter
temp_scheme
\family default
> : choice of the numerical scheme to integrate in time,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize

\family typewriter
\series bold
'euler'
\family default
\series default
 : the classical first order Euler explicit time stepping with a splitted
 implicit discretization of the friction source term.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'rk2'
\family default
\series default
 : a hybrid Runge-Kutta type time stepping scheme, a simple convex combination
 of the previous Euler time stepping, more precise and stable but only at
 first order.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'imex'
\family default
\series default
 : a Implicit-Explicit Runge-Kutta time stepping scheme giving a global
 second order method with an implicit discretization of the friction source
 term.
\end_layout

\begin_layout Standard
all schemes are stabilized with a small enough time step 
\begin_inset Formula $\Delta t$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
spatial_scheme
\family default
> : choice of the numerical scheme to integrate in space,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize

\family typewriter
\series bold
'first'
\family default
\series default
 : the Finite Volume Godonov scheme without well-balanced property.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'first_b1'
\family default
\series default
: the Finite Volume Godonov scheme with the Audusse and al.
 well-balanced property (recommended with the 
\family typewriter
\series bold
'euler'
\family default
\series default
 temporal scheme).
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'first_b2e'
\family default
\series default
 : the Finite Volume Godonov scheme with the Fernandez-Nieto and al.
 well-balanced property and a explicit equivalent bed elevation.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'first_b2i'
\family default
\series default
 : the Finite Volume Godonov scheme with the Fernandez-Nieto and al.
 well-balanced property and a implicit equivalent bed elevation.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'muscl'
\family default
\series default
 : the Finite Volume Godonov scheme with linear reconstructions at edges
 without well-balanced property.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'muscl_b'
\family default
\series default
 : the Finite Volume Godonov scheme with linear reconstructions at edges
 without well-balanced property and the Barth limiter.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'muscl_b1'
\family default
\series default
 : the Finite Volume Godonov scheme with linear reconstructions at edge
 with the Audusse and al.
 well-balanced property.
\end_layout

\begin_layout Itemize

\family typewriter
\series bold
'muscl_b1_b'
\family default
\series default
 : the Finite Volume Godonov scheme with linear reconstructions at edge
 with the Audusse and al.
 well-balanced property and the Barth limiter (recommended with the 
\family typewriter
\series bold
'imex'
\family default
\series default
 temporal scheme).
\end_layout

\begin_layout Standard
all with the same HLLC approximate Riemann solver with an 
\begin_inset Formula $L^{\infty}$
\end_inset

 stability property.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
adapt_dt
\family default
> : 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' the time step is fixed at the must provided <
\family typewriter
dt
\family default
> value.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' the time step is calculated and the <
\family typewriter
cfl
\family default
> number is applied.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
dt
\family default
> in [s] : fixed time step.
\end_layout

\begin_layout Itemize
<
\family typewriter
cfl
\family default
> : CFL-like number with a value 
\begin_inset Formula $\in\left[0,1\right]$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
heps
\family default
> in [m] : Cut-off water depth that can be usefull to stabilize schemes.
\end_layout

\begin_layout Itemize
<
\family typewriter
friction
\family default
> : '
\family typewriter
1
\family default
' active the inclusion of the Manning-Strickler source term in the Shallow
 Water model.
\end_layout

\begin_layout Itemize
<
\family typewriter
feedback_inflow
\family default
> : '
\family typewriter
1
\family default
' active a feedback control on ghost bathymetries to obtain the proper discharg
 desired at a subset 
\begin_inset Formula $\Gamma$
\end_inset

 of the computational domain boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
coef_feedback
\family default
> : coefficient applied to the feedback control (
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
warm{}
\end_layout

\end_inset

 be carefull to not enter a too strong value that will exhibit severe oscillatio
ns on the discharg).
\end_layout

\begin_layout Itemize
<
\family typewriter
max_nt_for_direct
\family default
> : maximum number of time iterations to perform.
 It can be usefull to cut a very long simulation.
\end_layout

\begin_layout Subsubsection
Physical parameters
\end_layout

\begin_layout Itemize
<
\family typewriter
g
\family default
> in [
\begin_inset Formula $m.s^{-2}$
\end_inset

] : gravitational acceleration.
\end_layout

\begin_layout Subsubsection
Output Results Files Switches
\begin_inset CommandInset label
LatexCommand label
name "subsec:Output-Results-Files-Switches"

\end_inset


\end_layout

\begin_layout Itemize
<
\family typewriter
w_tecplot
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' output of result files in ASCII Tecplot format.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
w_vtk
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' output of result files in ASCII VTK format.
\end_layout

\begin_layout Itemize
'
\family typewriter
2
\family default
' output of result files in binary VTK format.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
w_exact
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' output of exact solution result files and relative error norms.
 The exact solution must be provided in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
w_norm
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'1' relative 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms in time.
\end_layout

\begin_layout Itemize
'2' relative 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms integrated in time.
\end_layout

\begin_layout Itemize
'3' relative 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms at the end of the simuation.
\end_layout

\begin_layout Itemize
'4' absolute 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms in time.
\end_layout

\begin_layout Itemize
'5' absolute 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms integrated in time.
\end_layout

\begin_layout Itemize
'6' absolute 
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

 norms at the end of the simuation.
\end_layout

\begin_layout Standard
The norms are outputted in '
\family typewriter
norm_rel_x_yyy.zzz
\family default
' or '
\family typewriter
norm_abs_x_yyy.zzz
\family default
' files.
 The 
\family typewriter
x
\family default
 characters corresponds to the physical variable (
\begin_inset Formula $h$
\end_inset

, 
\begin_inset Formula $\left\Vert u\right\Vert $
\end_inset

and 
\begin_inset Formula $\left\Vert q\right\Vert $
\end_inset

), the 
\family typewriter
y
\family default
 characters to the norm type (
\begin_inset Formula $L^{1}$
\end_inset

, 
\begin_inset Formula $L^{2}$
\end_inset

 and 
\begin_inset Formula $L^{\infty}$
\end_inset

) and the 
\family typewriter
z
\family default
 characters to the file format.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
w_obs
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' output of observations result files and related cost function.
 The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file need to be prescribed.
\end_layout

\end_deeper
\begin_layout Itemize
<
\family typewriter
use_obs
\family default
> :
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
'
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
'
\family typewriter
1
\family default
' active the cost function calculation with the innovation vector.
\end_layout

\end_deeper
\begin_layout Subsubsection
Variational Data Assimilation Parameters
\end_layout

\begin_layout Itemize
<
\family typewriter
c_manning
\family default
>, <
\family typewriter
c_bathy
\family default
>, <
\family typewriter
c_ic
\family default
> , <
\family typewriter
c_hydrograph
\family default
> and <
\family typewriter
c_ratcurve
\family default
> : a value of '
\family typewriter
1
\family default
' active respectively the Manning-Strickler coefficient land use, the bed
 elevation, the initial condition, the hydrograph(s) and the rat curve(s)
 in the vector control to minimize, '
\family typewriter
0
\family default
' by default.
\end_layout

\begin_layout Itemize
<
\family typewriter
eps_manning
\family default
>, <
\family typewriter
eps_bathy
\family default
>, <
\family typewriter
eps_ic
\family default
> , <
\family typewriter
eps_hydrograph
\family default
> and <
\family typewriter
eps_ratcurve
\family default
> : coefficient to generate the perturbation control vector.
\end_layout

\begin_layout Itemize
<
\family typewriter
max_nt_for_adjoint
\family default
> : maximum number of adjoint time iterations to perform.
 It can be usefull to manage the memory consumption.
\end_layout

\begin_layout Itemize
<
\family typewriter
restart_min
\family default
> : maximum number of minimization iterations to perform.
 It can be usefull to cut a very long minimization process.
\end_layout

\begin_layout Itemize
<
\family typewriter
eps_min
\family default
> : m1qn3 parameter.
\end_layout

\begin_layout Subsection
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:The-usr-file"

\end_inset


\end_layout

\begin_layout Standard
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file contains Fortran user-functions to define model constants variables,
 initial condition, boundary conditions and eventually the exact solution.
\end_layout

\begin_layout Subsubsection
Bed elevation and Manning-Strickler coefficient
\end_layout

\begin_layout Itemize
<
\family typewriter
bathy_user( x , y )
\family default
> : returns the bed elevation at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
manning_user( x , y )
\family default
> : returns the Manning-Strickler roughness coefficient at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Initial condition
\end_layout

\begin_layout Itemize
<
\family typewriter
zs0_user( x , y )
\family default
> : returns the initial free surface elevation (
\begin_inset Formula $\eta=h+z_{b}$
\end_inset

) at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
u0_user( x , y )
\family default
> : returns the initial velocity in the horizontal x-direction at point
 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
v0_user( x , y )
\family default
> : returns the initial velocity in the vertical y-direction at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Boundary conditions
\end_layout

\begin_layout Itemize
<
\family typewriter
inflow_user( t , x , y )
\family default
> : returns a eventual complementary value to finish to define the inflow
 boundary condition at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

 and time 
\begin_inset Formula $t$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
outflow_user( t , x , y )
\family default
> : returns a eventual complementary value to finish to define the inflow
 boundary condition at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

 and time 
\begin_inset Formula $t$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Exact solution
\end_layout

\begin_layout Itemize
<
\family typewriter
zs_exact( x , y )
\family default
> : returns the exact free surface elevation (
\begin_inset Formula $\eta=h+z_{b}$
\end_inset

) at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
u_exact( x , y )
\family default
> : returns the exact velocity in the horizontal x-direction at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Itemize
<
\family typewriter
v_exact( x , y )
\family default
> : returns the exact velocity in the vertical y-direction at point 
\begin_inset Formula $(x,y)\in\Omega$
\end_inset

.
\end_layout

\begin_layout Subsection
Unstructured mesh files
\begin_inset CommandInset label
LatexCommand label
name "subsec:Unstructured-mesh-files"

\end_inset


\end_layout

\begin_layout Standard
The mesh file must be created outside 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 by a mesh generator software 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://www.robertschneiders.de/meshgeneration/software.html"
literal "false"

\end_inset


\end_layout

\end_inset

.
 This file contains :
\end_layout

\begin_layout Itemize
a first list of the mesh nodes with 
\begin_inset Formula $(x,y)$
\end_inset

 coordinates and eventually a 
\begin_inset Formula $z$
\end_inset

-coordinate defining the bed elevation.
\end_layout

\begin_layout Itemize
a second list of the mesh elements (cells and eventually edges) defined
 by a suited list of the previous defined nodes.
\end_layout

\begin_layout Standard
By default, a wall type boundary is applied at the boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

 of the computational domain 
\begin_inset Formula $\Omega$
\end_inset

.
 Boundary edges defining a subset 
\begin_inset Formula $\Gamma$
\end_inset

 of the computational boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

 where is considered an inflow or outflow boundary condition must be provided
 in the mesh file.
 Each subset 
\begin_inset Formula $\Gamma$
\end_inset

 is also defined by a group number and the boundary type to apply is controlled
 by the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Subsubsection
Inhouse format
\begin_inset CommandInset label
LatexCommand label
name "subsec:Inhouse-format"

\end_inset


\end_layout

\begin_layout Standard
In the previous 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software, an inhouse mesh format described in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:Inhouse-mesh-format"

\end_inset

 has been created in order to consider special issues in the Shallow Water
 model : the bed elevation 
\begin_inset Formula $z_{b}$
\end_inset

 and the Manning-Strickler roughness coefficient 
\begin_inset Formula $n$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align left
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="15" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ comment line
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-nodes
\begin_inset space \quad{}
\end_inset

number-of-cells
\begin_inset space \quad{}
\end_inset

scaling
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ comment line
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
node-index
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coordinate
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coordinate
\begin_inset space \quad{}
\end_inset

bed-elevation
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ comment line
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
cell-index
\begin_inset space \quad{}
\end_inset

node1
\begin_inset space \quad{}
\end_inset

node2
\begin_inset space \quad{}
\end_inset

node3
\begin_inset space \quad{}
\end_inset

node4
\begin_inset space \quad{}
\end_inset

land-code
\begin_inset space \quad{}
\end_inset

bed-elevation
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ comment line
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
INLET
\begin_inset space \quad{}
\end_inset

number-of-cells
\begin_inset space \quad{}
\end_inset

number-of-inlet
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
cell-index
\begin_inset space \quad{}
\end_inset

edge-index
\begin_inset space \quad{}
\end_inset

boundary-type
\begin_inset space \quad{}
\end_inset

ghost-cell-bed-elevation[, group-number]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
OUTLET number-of-cells number-of-outlet
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
cell-index
\begin_inset space \quad{}
\end_inset

edge-index
\begin_inset space \quad{}
\end_inset

boundary-type
\begin_inset space \quad{}
\end_inset

ghost-cell-bed-elevation[, group-number]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Inhouse mesh format file ([.] denotes an optional parameter).
\begin_inset CommandInset label
LatexCommand label
name "tab:Inhouse-mesh-format"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

The bed elevation can be defined by two ways :
\end_layout

\begin_layout Itemize
at the nodes corresponding to the z-coordinate in the node list.
\end_layout

\begin_layout Itemize
at the cells gravity center (piecewise constant approximation over mesh
 cells) 
\begin_inset Foot
status open

\begin_layout Plain Layout
the only way yet in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{} 
\backslash
version{}
\end_layout

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The Manning-Strickler roughness coefficients are defined as a land use (zoning)
 if the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file is found in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
 The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file format is given in Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:The-landuse-file"

\end_inset

.
 According to the prescribed land code of a cell in the inhouse mesh format
 file Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:Inhouse-mesh-format"

\end_inset

, the Manning-Strickler coefficient is defined with the associated value
 to land code in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-lands
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines ...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
land-code-1
\begin_inset space \quad{}
\end_inset

Manning-Strickler-coefficient-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
land-code-2
\begin_inset space \quad{}
\end_inset

Manning-Strickler-coefficient-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file format.
 An example of file is given in appendix 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Example-of-landuse"

\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "tab:The-landuse-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Otherwise, if the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file is not found in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory, the Manning-Strickler coefficients are defined by the <
\family typewriter
manning_user( x , y )
\family default
> Fortran function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:The-usr-file"

\end_inset

.
 The function is called for each cell gravity center.
\end_layout

\begin_layout Standard
In the last part of the inhouse mesh format file Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:Inhouse-mesh-format"

\end_inset

, two subsets 
\begin_inset Formula $\Gamma_{in}$
\end_inset

 and 
\begin_inset Formula $\Gamma_{out}$
\end_inset

 of the computational boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

 are defined to consider inflow(s) and/or outflow(s) boundary conditions.
 The inflow(s) and outflow(s) boundary conditions definition are divided
 into two successive parts.
 Beginning by the inflow(s) boundary condition(s), the number of cells just
 after the INLET label represents the total number of interior cells at
 boundary of the computational domain made up the subset 
\begin_inset Formula $\Gamma_{in}$
\end_inset

.
 The number of inlet represents the number of inflows to consider in the
 subset 
\begin_inset Formula $\Gamma_{in}$
\end_inset

.
 If this number is not zero, then the group number of the inflow must be
 provided for each interior cell.
 This is the same construction after the OUTLET label.
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
warm{}
\end_layout

\end_inset

 Be carefull that if one of the numbers of inlet and outlet is zero, other
 one must be zero.
 In this case, no group number has to provided and the group 1 is automatically
 assigned to the inflow and the group 2 to the outflow.
\end_layout

\begin_layout Standard
Let's consider an exemple with the piece of mesh Fig.
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:ex-bc-inhouse"

\end_inset

.
 We will find the following lines in the mesh file,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset listings
lstparams "basicstyle={\ttfamily}"
inline false
status collapsed

\begin_layout Plain Layout

22    6   5   3   6
\end_layout

\begin_layout Plain Layout

31    5   4  10   5
\end_layout

\begin_layout Plain Layout

53    1   2   3   1
\end_layout

\begin_layout Plain Layout

65   21  11  15  21
\end_layout

\begin_layout Plain Layout

69   17  20  22  17
\end_layout

\begin_layout Plain Layout

70   21  19  17  21
\end_layout

\begin_layout Plain Layout

100  10  12  11  10
\end_layout

\end_inset


\end_layout

\begin_layout Standard
and in the part defining the inflow(s) or outflow(s) boundary condition,
 we will find,
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset listings
lstparams "basicstyle={\ttfamily}"
inline false
status collapsed

\begin_layout Plain Layout

22    2   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

31    3   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

53    3   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

65    1   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

69    3   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

70    3   1   ghost-cell-bed-elevation
\end_layout

\begin_layout Plain Layout

100   3   1   ghost-cell-bed-elevation
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The ghost cells bed elevation definition is an important issue because it
 controls in a certain proportion the flow at inflow(s) and outflow(s).
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/meshBoundaries.pdf
	lyxscale 75
	width 50text%

\end_inset

 
\begin_inset Caption Standard

\begin_layout Plain Layout
Example of boundary condition definition.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:ex-bc-inhouse"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Gmsh format
\begin_inset CommandInset label
LatexCommand label
name "subsec:Gmsh-format"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Quotes eld
\end_inset


\shape italic
Gmsh is a 3D finite element grid generator with a build-in CAD engine and
 post-processor.
 Its design goal is to provide a fast, light and user-friendly meshing tool
 with parametric input and advanced visualization capabilities.
 Gmsh is built around four modules: geometry, mesh, solver and post-processing.
 The specification of any input to these modules is done either interactively
 using the graphical user interface or in ASCII text files using Gmsh's
 own scripting language
\shape default
.
\begin_inset Quotes erd
\end_inset

 
\begin_inset Foot
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
target "http://geuz.org/gmsh/"
literal "false"

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset VSpace defskip
\end_inset


\end_layout

\begin_layout Standard
The Gmsh free software can be used to create a unstructured mesh with triangles,
 quadrangles or both and then interface with 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
The computational domain boundary has to be defined in a first time using
 the Gmsh graphical user interface or creating directly a .geo file like
 the given example in the Lst.
\begin_inset CommandInset ref
LatexCommand eqref
reference "lis:multibc-geo-file"

\end_inset

.
 The 
\begin_inset Quotes eld
\end_inset


\shape italic
physical entities
\shape default

\begin_inset Quotes erd
\end_inset

 have then been to be defined in order to create the mesh (the 
\begin_inset Quotes eld
\end_inset


\shape italic
physical surface
\shape default

\begin_inset Quotes erd
\end_inset

 in the Lst.
\begin_inset CommandInset ref
LatexCommand eqref
reference "lis:multibc-geo-file"

\end_inset

) and mainly to define the inflow/outflow boundary conditions (the 
\begin_inset Quotes eld
\end_inset


\shape italic
physical line
\shape default

\begin_inset Quotes erd
\end_inset

 in the Lst.
\begin_inset CommandInset ref
LatexCommand eqref
reference "lis:multibc-geo-file"

\end_inset

).
 An important issue is that the chronological order of definition of the
 
\begin_inset Quotes eld
\end_inset


\shape italic
physical lines
\shape default

\begin_inset Quotes erd
\end_inset

 will assign in ascending order the label of the inflow/outflow boundary
 conditions.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},frame=single"
inline false
status collapsed

\begin_layout Plain Layout

lc = 10;
\end_layout

\begin_layout Plain Layout

Point(1) = {0, 0, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(2) = {0, 100, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(3) = {1000, 0, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(4) = {1000, 100, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(5) = {0, 200, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(6) = {0, 300, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(7) = {1000, -100, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(8) = {1000, -200, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(9) = {350, 100, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(10) = {450, 100, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(11) = {650, 0, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(12) = {550, 0, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(13) = {200, 180, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(14) = {200, 280, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(15) = {800, -80, 0, lc};
\end_layout

\begin_layout Plain Layout

Point(16) = {800, -180, 0, lc};
\end_layout

\begin_layout Plain Layout

Line(1) = {1, 2};
\end_layout

\begin_layout Plain Layout

Line(2) = {3, 4};
\end_layout

\begin_layout Plain Layout

Line(3) = {5, 6};
\end_layout

\begin_layout Plain Layout

Line(4) = {7, 8};
\end_layout

\begin_layout Plain Layout

Line(5) = {1, 12};
\end_layout

\begin_layout Plain Layout

Line(6) = {2, 9};
\end_layout

\begin_layout Plain Layout

Line(7) = {3, 11};
\end_layout

\begin_layout Plain Layout

Line(8) = {4, 10};
\end_layout

\begin_layout Plain Layout

BSpline(9) = {5, 13, 9};
\end_layout

\begin_layout Plain Layout

BSpline(10) = {6, 14, 10};
\end_layout

\begin_layout Plain Layout

BSpline(11) = {8, 16, 12};
\end_layout

\begin_layout Plain Layout

BSpline(12) = {7, 15, 11};
\end_layout

\begin_layout Plain Layout

Line Loop(14) = {5, -11, -4, 12, -7, 2, 8, -10, -3, 9, -6, -1};
\end_layout

\begin_layout Plain Layout

Plane Surface(14) = {14};
\end_layout

\begin_layout Plain Layout

Physical Line("in1") = {1};
\end_layout

\begin_layout Plain Layout

Physical Line("in2") = {3};
\end_layout

\begin_layout Plain Layout

Physical Line("out1") = {2};
\end_layout

\begin_layout Plain Layout

Physical Line("out2") = {4};
\end_layout

\begin_layout Plain Layout

Physical Surface("surf") = {14};
\begin_inset Caption Standard

\begin_layout Plain Layout
the 
\family typewriter
multibc.geo
\family default
 file in Gmsh format building the geometry and the mesh in Fig.
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:multibc-gmsh"

\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "lis:multibc-geo-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
After typing the command '
\family typewriter
gmsh -2 multibc.geo
\family default
', the resulting generated mesh is showed in the Fig.
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:multibc-gmsh"

\end_inset

.
 But one can also use the graphical user interface to generate the mesh
 and so the numerous Gmsh tools.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/multibc_mesh.pdf
	lyxscale 40
	width 80text%

\end_inset

 
\begin_inset Caption Standard

\begin_layout Plain Layout
Example of mesh generation with Gmsh.
 Node and line numbers correspond to the listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:multibc-geo-file"

\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "fig:multibc-gmsh"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Boundary conditions
\begin_inset CommandInset label
LatexCommand label
name "subsec:Boundary-conditions"

\end_inset


\end_layout

\begin_layout Standard
The available boundary conditions are listed in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:bc"

\end_inset

.
 There are three main types of boundary conditions : the wall, the inflow
 and the outflow 
\begin_inset Foot
status open

\begin_layout Plain Layout
the periodic boundary condition is not yet available.
\end_layout

\end_inset

 with subtype for the inflow and the outflow.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="8" columns="4">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="middle" width="35text%">
<column alignment="center" valignment="middle" width="35text%">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Data
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Wall
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
wall
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
wall/slip condition
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="3" alignment="center" valignment="middle" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Inflow
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
discharg1
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
discharg is imposed (approximate backwater curve)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file if exists in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory,
\end_layout

\begin_layout Plain Layout
the <
\family typewriter
inflow_user( t , x , y )
\family default
> Fortran function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file otherwise.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="4" alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
discharg2
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
discharg is imposed (fixed water elevation)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file if exists in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory,
\end_layout

\begin_layout Plain Layout
the <
\family typewriter
inflow_user( t , x , y )
\family default
> Fortran function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file otherwise.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="3" alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Outflow
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
transm
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
homogeneous Neumann
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="4" alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
zspresc
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
water elevation 
\begin_inset Formula $\eta$
\end_inset

 is prescribed
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
the <
\family typewriter
outflow_user( t , x , y )
\family default
> Fortran function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="4" alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
hpresc
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
water depth 
\begin_inset Formula $h$
\end_inset

 is prescribed
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
the <
\family typewriter
outflow_user( t , x , y )
\family default
> Fortran function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset
</cell>
</row>
<row>
<cell multirow="4" alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
'
\family typewriter
ratcurve
\family default
'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
rating curve based
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Available boundary conditions.
\begin_inset CommandInset label
LatexCommand label
name "tab:bc"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
For a cartesian mesh, the boundary condition type is prescribed directly
 at one face of the computational domain boundary setting the <
\family typewriter
bc_N
\family default
>, <
\family typewriter
bc_S
\family default
>, <
\family typewriter
bc_W
\family default
> and <
\family typewriter
bc_E
\family default
> variables in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:The-inp-file"

\end_inset

 to the desired associated name in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:bc"

\end_inset

.
\end_layout

\begin_layout Standard
For a unstructured mesh, the boundary condition type is prescribed in the
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file in the format described in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:bc-file"

\end_inset

.
 A group number is assigned at each subset of the computational domain boundary
 
\begin_inset Formula $\partial\Omega$
\end_inset

 as explainded in the previous section
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Unstructured-mesh-files"

\end_inset

.
 Thus, the associated type of boundary condition is read in this 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file that provides a relative flexibility.
 If no 
\series bold
data-type 
\family typewriter
\series default
file
\family default
 is prescribed, then the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file is used to define the inflow and the outflow.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-tagged-bc
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
group-1
\begin_inset space \quad{}
\end_inset

bc-type-1
\begin_inset space \quad{}
\end_inset

[data-type-1]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
group-2
\begin_inset space \quad{}
\end_inset

bc-type-2
\begin_inset space \quad{}
\end_inset

[data-type-2]
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file format.
\begin_inset CommandInset label
LatexCommand label
name "tab:bc-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Wall
\end_layout

\begin_layout Standard
The '
\family typewriter
wall
\family default
' boundary condition type is a slip condition since there is no viscous
 term in the model.
 It can be also used as a symmetry boundary condition.
 It is the default boundary condition assigned at a boundary edge not in
 a defined subset of the computational domain boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Inflow
\end_layout

\begin_layout Standard
The inflow boundary condition consists of applying a discharge 
\begin_inset Formula $Q(t)$
\end_inset

 to a subset 
\begin_inset Formula $\Gamma$
\end_inset

 of the computational domain boundary 
\begin_inset Formula $\partial\Omega$
\end_inset

.
 The discharge relation 
\begin_inset Formula $Q(t)$
\end_inset

 is prescribed either by the <
\family typewriter
inflow_user( t , x , y )
\family default
> user-function in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file or by the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:hydrograph-file"

\end_inset

.
 The 
\series bold
data-type
\series default
 option must be setted to '
\family typewriter
file
\family default
' in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file in order to use the tabulated values of the relation 
\begin_inset Formula $Q(t)$
\end_inset

 law in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Standard
The type '
\family typewriter
discharg1
\family default
' gives a more robust method to prescribed the discharge relation 
\begin_inset Formula $Q(t)$
\end_inset

.
 It should be preferred to the '
\family typewriter
discharg
\family default
2' type which can be more precise but can generate a calculation divergence.
\end_layout

\begin_layout Standard
When the considered wet surface corresponding to 
\begin_inset Formula $\Gamma$
\end_inset

 is non trivial, practice shows that one can observe a wrong prescribed
 discharge 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $Q(t)$
\end_inset

.
 In order to overcome this drawback, a solution is to apply a feedback process
 on the associated ghost bed elevations setting the variable 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
<
\family typewriter
feedback_inflow
\family default
> to 
\family typewriter
'1'
\family default
 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file (by default) and eventually changing the associated feedback process
 coefficient <
\family typewriter
coef_feedback
\family default
> (to '
\family typewriter
0.1
\family default
' by default).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="12" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-hydrographs
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-tabulated-times-hydrograph-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
t11
\begin_inset space \quad{}
\end_inset

Q11
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
t12
\begin_inset space \quad{}
\end_inset

Q12
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-tabulated-times-hydrograph-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
t21
\begin_inset space \quad{}
\end_inset

Q21
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
t22
\begin_inset space \quad{}
\end_inset

Q22
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file format.
\begin_inset CommandInset label
LatexCommand label
name "tab:hydrograph-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Outflow
\end_layout

\begin_layout Standard
The outflow boundary condition can be prescribed in different ways :
\end_layout

\begin_layout Itemize
the '
\family typewriter
transm
\family default
' type for which simple homogeneous Neumann conditions are applied to water
 depth and normal velocity.
 It can be used in simple cases where the ghost bed elevations are well
 defined (a constant slope channel for example).
 Otherwise, it can generates an improper outflow boundary condition.
\end_layout

\begin_layout Itemize
the '
\family typewriter
zspresc
\family default
' and '
\family typewriter
hpresc
\family default
' types where respectively a water surface relation 
\begin_inset Formula $z_{b}(t)$
\end_inset

 and a water depth relation 
\begin_inset Formula $h(t)$
\end_inset

 are imposed at the boundary.
\end_layout

\begin_layout Itemize
the '
\family typewriter
ratcurve
\family default
' type for which a tabulated rating curve in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file described in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:ratcurve-file"

\end_inset

 is used to impose a relation 
\begin_inset Formula $h(Q)$
\end_inset

 at the boundary.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="12" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-rating-curves
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-tabulated-water-elevation-1
\begin_inset space \quad{}
\end_inset

water-elevation-reference
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
h11
\begin_inset space \quad{}
\end_inset

Q11
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
h12
\begin_inset space \quad{}
\end_inset

Q12
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ 3 comment lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
number-of-tabulated-water-elevation-2
\begin_inset space \quad{}
\end_inset

water-elevation-reference
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
h21
\begin_inset space \quad{}
\end_inset

Q21
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
h22
\begin_inset space \quad{}
\end_inset

Q22
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file format.
\begin_inset CommandInset label
LatexCommand label
name "tab:ratcurve-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Observations
\begin_inset CommandInset label
LatexCommand label
name "subsec:Observations"

\end_inset


\end_layout

\begin_layout Standard
There is the possibility to generate output result files containing user
 defined observations.
 This can be realized creating a 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file at the root of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory according to the format Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:obs-file"

\end_inset

.
 The control variable <
\family typewriter
w_obs
\family default
> must be setted to '
\family typewriter
1
\family default
' in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Standard
In context of the shallow water model, two types of observations are possible,
\end_layout

\begin_layout Itemize
The stations : the evolution in time of the water depth 
\begin_inset Formula $h(t)$
\end_inset

 and the velocity components 
\begin_inset Formula $u(t)$
\end_inset

 and 
\begin_inset Formula $v(t)$
\end_inset

 are outputted with a prescribed time step and a weight (usefull for the
 cost function definition 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Cost-function"

\end_inset

),
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
a user-defined point representing the constant value of the cell containing
 the point (stations keyword).
\end_layout

\begin_layout Itemize
a list of user-defined points representing the mean value over the constant
 values of the cells containing the list of points (stations_with_grp keyword).
\end_layout

\end_deeper
\begin_layout Itemize
The sections : the evolution in time and along a line of the water depth
 
\begin_inset Formula $h(t,x,y)$
\end_inset

 and the velocity components 
\begin_inset Formula $u(t,x,y)$
\end_inset

 and 
\begin_inset Formula $v(t,x,y)$
\end_inset

 are outputted with a prescribed number of points and time step.
 It is written the constant values of the cells containing each line point.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="15" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ free lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
stations
\series default
 number-of-stations
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

station-1-dt
\begin_inset space \quad{}
\end_inset

station-1-weight
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

station-2-dt
\begin_inset space \quad{}
\end_inset

station-2-weight
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ free lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
stations_with_grp
\series default
 number-of-stations
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
station-1-label
\begin_inset space \quad{}
\end_inset

station-1-dt
\begin_inset space \quad{}
\end_inset

station-1-weight
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
station-2-label
\begin_inset space \quad{}
\end_inset

station-2-dt
\begin_inset space \quad{}
\end_inset

station-2-weight
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ free lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
sections
\series default
 number-of-sections
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

section-1-nb-of-points
\begin_inset space \quad{}
\end_inset

section-1-dt
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

section-2-nb-of-points
\begin_inset space \quad{}
\end_inset

section-2-dt
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file format.
\begin_inset CommandInset label
LatexCommand label
name "tab:obs-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In case of stations defined with a group of cells (stations_with_grp), a
 file per station '
\family typewriter
station_grp_xxxx.txt
\family default
' must be provided with a two column list of points or cell indexes to finish
 to define the observation (the 
\family typewriter
x
\family default
 characters is corresponding to the station label).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="40text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ free lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
points
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $x$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="20text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="40text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ free lines
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
indexes
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
index-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
index-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The '
\family typewriter
station_grp_xxxx.txt
\family default
' file format to define a group of cells representing a station observation.
\begin_inset CommandInset label
LatexCommand label
name "tab:obs-file-grp"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In a SWOT context, it is necessary to add an other file to the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory, the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
paramObs{}
\end_layout

\end_inset

 file.
 This file is used to provide informations to 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 about SWOT parameters.
 Those informations, for each observation stations, are: the lenght of river
 which is observed by the SWOT band, time observation, coordinates of intersecti
ons points between river and SWOT band.
 The format of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
paramObs{}
\end_layout

\end_inset

 file is detailled in Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:param-obs-file"

\end_inset

.
\end_layout

\begin_layout Standard

\series bold
Remarks
\series default
 : In a SWOT case, parameter obs-dt-X define in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
paramObs{}
\end_layout

\end_inset

 correponds to the offset of SWOT passage of SWOT band X and station-X-dt
 of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 corresponds to the SWOT satellite period.
\end_layout

\begin_layout Standard
\begin_inset Separator parbreak
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
number-of-stations
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
river-length-1
\begin_inset space \quad{}
\end_inset

obs-dt-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
river-length-2
\begin_inset space \quad{}
\end_inset

obs-dt-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
river-length-3
\begin_inset space \quad{}
\end_inset

obs-dt-3
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-coord-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-coord-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
paramObs{}
\end_layout

\end_inset

 file format.
\begin_inset CommandInset label
LatexCommand label
name "tab:param-obs-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Outputs
\end_layout

\begin_layout Standard
All output result files are written in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
binres{}
\end_layout

\end_inset

 directory.
 The frequency and the format(s) are controlled in the user-defined 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file respectively by the <
\family typewriter
dtw
\family default
>, <
\family typewriter
dt
\family default
p> and <
\family typewriter
dt
\family default
a> time steps and the output switches described in the section 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Output-Results-Files-Switches"

\end_inset

.
\end_layout

\begin_layout Subsection
Model unknows
\end_layout

\begin_layout Standard
The Shallow Water model primitive unknows 
\begin_inset Formula $h$
\end_inset

, 
\begin_inset Formula $u$
\end_inset

, 
\begin_inset Formula $v$
\end_inset

 as some model constants 
\begin_inset Formula $z_{b}$
\end_inset

, 
\begin_inset Formula $n$
\end_inset

 can be written in output result files with the <
\family typewriter
dtw
\family default
> time step in some available formats,
\end_layout

\begin_layout Itemize
the VTK format (
\family typewriter
.vtk
\family default
 extension) in ASCII encoding setting the <
\family typewriter
w_vtk
\family default
> to '
\family typewriter
1
\family default
' and in binary encoding setting the <
\family typewriter
w_vtk
\family default
> to '2'.
\end_layout

\begin_layout Itemize
the Tecplot format (
\family typewriter
.plt
\family default
 extension) in ASCII encoding setting the <
\family typewriter
w_tecplot
\family default
> to '
\family typewriter
1
\family default
'.
\end_layout

\begin_layout Standard
The file names are '
\family typewriter
result_xxxxxxE+xx.
\family default
yyy' where the 
\family typewriter
x
\family default
 characters are representing the simulation time, except for the initial
 and final output result files for which the file names are respectively
 '
\family typewriter
result_initial.
\family default
yyy' and '
\family typewriter
result_final.
\family default
yyy', and the y characters the above file format.
\end_layout

\begin_layout Subsection
Post-processed variables
\end_layout

\begin_layout Standard
Several post-processed variables are also written in output result files
 with the <
\family typewriter
dt
\family default
p> time step and in the format defined in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file by the switches described in the section 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Output-Results-Files-Switches"

\end_inset

,
\end_layout

\begin_layout Itemize
the time step 
\begin_inset Formula $dt$
\end_inset

 in 
\begin_inset Formula $\left[s\right]$
\end_inset

 in the '
\family typewriter
time_step.yyy
\family default
' file.
\end_layout

\begin_layout Itemize
the volume of water in the computational domain in 
\begin_inset Formula $\left[m^{3}\right]$
\end_inset

 in the '
\family typewriter
water_vol.yyy
\family default
' file.
\end_layout

\begin_layout Itemize
the volume of water in the computational domain in 
\begin_inset Formula $\left[m^{3}\right]$
\end_inset

 eventually added numerically in the '
\family typewriter
water_vol_num_add.yyy
\family default
' file (Effect of cutting negative water depth in mass conservation).
\end_layout

\begin_layout Itemize
the discharges in 
\begin_inset Formula $\left[m^{3}.s^{-1}\right]$
\end_inset

 at inflow and outflow in the '
\family typewriter
sum_mass_flux_zzz_xxx.yyy
\family default
' and '
\family typewriter
sum_q_zzz_xxx.yyy
\family default
' files.
 The 
\family typewriter
z
\family default
 characters is 
\family typewriter
inflow
\family default
 or 
\family typewriter
outflow
\family default
, the x characters the label of the boundary.
\end_layout

\begin_layout Subsection
Observations
\end_layout

\begin_layout Standard
An observation output result file is generated according to the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file for each defined station and two files for each defined section,
\end_layout

\begin_layout Itemize
the '
\family typewriter
obs_station_yyyy.xxx
\family default
' files with the format described in Tab.
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:station-file"

\end_inset

.
\end_layout

\begin_layout Itemize
the '
\family typewriter
obs_section_yyyy.xxx
\family default
' files with the format described in Tab.
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:section-file-1"

\end_inset

.
\end_layout

\begin_layout Itemize
the '
\family typewriter
obs_q_h_section_yyyy.xxx
\family default
' files with the format described in Tab.
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:section-file-2"

\end_inset

.
\end_layout

\begin_layout Standard
where the 
\family typewriter
y
\family default
 characters are the label of the stations and the sections.
 These labels are defined in ascending order.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ header according to the format choosen
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
time-1
\begin_inset space \quad{}
\end_inset

water-depth-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-component-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-component-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
time-2
\begin_inset space \quad{}
\end_inset

water-depth-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-component-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-component-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
the '
\family typewriter
obs_station_yy.xxx
\family default
' files format.
\begin_inset CommandInset label
LatexCommand label
name "tab:station-file"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ header according to the format choosen
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ time-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $x1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

bathy-1
\begin_inset space \quad{}
\end_inset

depth-1-1
\begin_inset space \quad{}
\end_inset

elevation-1-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-1-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-1-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $x2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

bathy-2
\begin_inset space \quad{}
\end_inset

depth-2-1
\begin_inset space \quad{}
\end_inset

elevation-2-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-2-1
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-2-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ time-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $x1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y1$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

bathy-1
\begin_inset space \quad{}
\end_inset

depth-1-2
\begin_inset space \quad{}
\end_inset

elevation-1-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-1-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-1-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
\begin_inset Formula $x2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y2$
\end_inset

-coord
\begin_inset space \quad{}
\end_inset

bathy-2
\begin_inset space \quad{}
\end_inset

depth-2-2
\begin_inset space \quad{}
\end_inset

elevation-2-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $x$
\end_inset

-velocity-2-2
\begin_inset space \quad{}
\end_inset


\begin_inset Formula $y$
\end_inset

-velocity-2-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
the '
\family typewriter
obs_section_yy.xxx
\family default
' files format.
\begin_inset CommandInset label
LatexCommand label
name "tab:section-file-1"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="1">
<features booktabs="true" tabularvalignment="middle" tabularwidth="100text%">
<column alignment="left" valignment="top" width="0pt">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
$ header according to the format choosen
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
water-depth-max-1
\begin_inset space \quad{}
\end_inset

discharge-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
water-depth-max-2
\begin_inset space \quad{}
\end_inset

discharge-2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
the '
\family typewriter
obs_q_h_section_yy.xxx
\family default
' files format.
\begin_inset CommandInset label
LatexCommand label
name "tab:section-file-2"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Cost function
\begin_inset CommandInset label
LatexCommand label
name "subsec:Cost-function"

\end_inset


\end_layout

\begin_layout Standard
A cost function is calculated and printed to screen at the end of the simulation
,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
J={\displaystyle \sum_{i=1,\mathrm{Nobs}}\;\omega_{i}\;\sum_{j=1,\mathrm{Ntimes}}\;\left(\left(\bar{h}_{i,j}\:-\:\bar{h}_{i,j}^{obs}\right)+\left(\bar{w}_{i,j}\:-\:\bar{w}_{i,j}^{obs}\right)\right)^{2}}\label{eq:cost-function}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\mathrm{Nobs}$
\end_inset

 is the number of stations and 
\begin_inset Formula $\mathrm{Ntimes}$
\end_inset

 the time serie number, both controlled by the user-defined 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Observations"

\end_inset

.
\end_layout

\begin_layout Standard
The observations files can be generated by a previous simulation or created
 in the same format described in the Tab.
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:station-file"

\end_inset

.
 These files have to be placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
binobs{}
\end_layout

\end_inset

 directory (must be created) and the control variable <
\family typewriter
use_obs
\family default
> has to be setted to '
\family typewriter
1
\family default
'.
 Otherwise, the 
\begin_inset Formula $h^{obs}$
\end_inset

 are not taken into account in the Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:cost-function"

\end_inset

.
\end_layout

\begin_layout Standard
For more detail see 
\begin_inset CommandInset ref
LatexCommand ref
reference "part:CostFunction"

\end_inset

.
\end_layout

\begin_layout Subsection
Restart file and initial condition generation
\end_layout

\begin_layout Standard
A file named '
\family typewriter
restart.bin
\family default
' is written in addition to the model output result files.
 In particular, it can be used to perform a long simulation in several times
 setting the variable <
\family typewriter
max_nt_for_direct
\family default
> to a maximum number of iterations to perform for each part of the long
 simulation.
\end_layout

\begin_layout Standard
This '
\family typewriter
restart.bin
\family default
' file can be renamed in '
\family typewriter
ic.bin
\family default
' file and used as an initial condition.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Adjoint Model
\end_layout

\begin_layout Standard
In order to calculate the gradient of the cost function 
\begin_inset Formula $\nabla J$
\end_inset

 in a relative minimum of time computation, and so to perform sensibility
 analysis 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:Sensibility-analysis"

\end_inset

 or data assimilation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "subsec:4D-Var-data-assimilation"

\end_inset

, the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software has been originally designed, in sense of source code structuration,
 to generate automatically the discrete model adjoint using the differentiation
 tool 
\series bold
Tapenade
\series default
.
 Some final tricks calling a Perl program 
\begin_inset Foot
status open

\begin_layout Plain Layout

\family typewriter
./src/adjoint/finish_to_gen_adjoint.pl
\end_layout

\end_inset

 have also been implemented to override some 
\series bold
Tapenade
\series default
 manual operations (dynamic array sizes, adjoint variables management and
 the adjoint of the MPI standard communication operations) in order to really
 achieve to a complete automatic generation.
 User can for example define a new cost function and so generate the associated
 discrete model adjoint.
\end_layout

\begin_layout Subsection
Adjoint Generation
\end_layout

\begin_layout Itemize
The automatic generation is called typing the command '
\family typewriter
make run tap_files
\family default
' at the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 root directory.
 All discrete adjoint model source files are placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tap{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Itemize
In order to compile/link these source files, the 
\family typewriter
ADJOINT
\family default
 variable must be set to '
\family typewriter
1
\family default
' in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

.
\end_layout

\begin_layout Itemize
Then, typing the commane '
\family typewriter
make
\family default
' generates the executable 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Subsection
Sensibility analysis
\begin_inset CommandInset label
LatexCommand label
name "subsec:Sensibility-analysis"

\end_inset


\end_layout

\begin_layout Standard
The generation of the discrete model adjoint provides a way to perform sensibili
ty analysis and estimate the influence of the different parameters.
 If 
\begin_inset Formula $\mathbf{k}$
\end_inset

 denotes the control vector containing all the parameters, then the absolute
 model sensibility to a given parameter 
\begin_inset Formula $k_{i}$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
s_{k_{i}}={\displaystyle \frac{\partial J}{\partial k_{i}}}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
are written in output result files providing a measure of the model change
 response due to a change of a given parameter.
\end_layout

\begin_layout Standard
This mode is called typing 'make rungrad' at the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 root directory (or typing './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
grad'
\family default
 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory in sequential mode and '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
grad
\family default
' in parallel mode).
\end_layout

\begin_layout Standard
In context of the Shallow Water model, the control vector 
\begin_inset Formula $\mathbf{k}$
\end_inset

 and the corresponding output result files are,
\end_layout

\begin_layout Itemize
the hydrograph time series and its gradient in the '
\family typewriter
hydographxxx_grad
\family default
' files.
 The 
\family typewriter
x
\family default
 characters denotes the label of the hydograph.
\end_layout

\begin_layout Itemize
the bed elevation scalar field 
\begin_inset Formula $z_{b}$
\end_inset

 and its gradient in the '
\family typewriter
bathy_grad.yyy'
\family default
 file.
 The 
\family typewriter
y
\family default
 characters correspond to the file format.
\end_layout

\begin_layout Itemize
the Manning-Strickler roughness coefficient 
\begin_inset Formula $n$
\end_inset

 and its gradient in the '
\family typewriter
manning_grad.yyy
\family default
' file.
 The 
\family typewriter
y
\family default
 characters correspond to the file format.
\end_layout

\begin_layout Standard
All these output result files are placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bingrad{}
\end_layout

\end_inset

 directory at the end of the calcultation of the cost function gradient
 
\begin_inset Formula $\nabla J$
\end_inset

.
\end_layout

\begin_layout Subsection
4D-Var data assimilation
\begin_inset CommandInset label
LatexCommand label
name "subsec:4D-Var-data-assimilation"

\end_inset


\end_layout

\begin_layout Standard
In this mode, a local minimum of the cost function is seeked using the discrete
 model adjoint to calculate the cost function gradient 
\begin_inset Formula $\nabla J$
\end_inset

 and a local descent algorithm, i.e.
 
\series bold
m1qn3
\series default
.
 One can identify the model input control variables 
\begin_inset Quotes eld
\end_inset

matching at best
\begin_inset Quotes erd
\end_inset

 with observation data.
\end_layout

\begin_layout Standard
The identification process principle is sketched in Fig
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:Identification-process-principle"

\end_inset

.
 Given a first guess 
\begin_inset Formula $\mathbf{k}_{0}$
\end_inset

 (user is free to configure his first guess as he would have configured
 a direct simulation), we week the iterates 
\begin_inset Formula $\mathbf{k}_{i}$
\end_inset

 which make decrease the cost function using a descent algorithm.
 To do so, at each iterate,
\end_layout

\begin_layout Enumerate
the cost function 
\begin_inset Formula $J(\mathbf{k}_{i})$
\end_inset

 and its gradient 
\begin_inset Formula $\nabla J(\mathbf{k}_{i})$
\end_inset

 are computed calling the discrete forward model (from 
\begin_inset Formula $0$
\end_inset

 to 
\begin_inset Formula $T$
\end_inset

) and its adjoint (from 
\begin_inset Formula $T$
\end_inset

 to 
\begin_inset Formula $0$
\end_inset

, reverse in time).
\end_layout

\begin_layout Enumerate
given 
\begin_inset Formula $\mathbf{k}_{i}$
\end_inset

 , 
\begin_inset Formula $J(\mathbf{k}_{i})$
\end_inset

 and 
\begin_inset Formula $\nabla J(\mathbf{k}_{i})$
\end_inset

, the m1qn3 library is invoked in order to find a new iterate such that
 
\begin_inset Formula $J(\mathbf{k}_{i+1})<J(\mathbf{k}_{i})$
\end_inset

.
\end_layout

\begin_layout Enumerate
the convergnce criteria is tested, i.e., the <
\family typewriter
eps_min
\family default
> parameter in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/daorganisation.pdf
	width 60text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
4D-Var identification process principle.
\begin_inset CommandInset label
LatexCommand label
name "fig:Identification-process-principle"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
This mode is called typing 'make runmin' at the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 root directory (or typing './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
min'
\family default
 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory in sequential mode and '
\family typewriter
mpirun -np
\family default
 <
\family typewriter
NB_PROC
\family default
> './
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset

 
\family typewriter
min
\family default
' in parallel mode).
 The iterate informations are written on screen and in the '
\family typewriter
min_cost.txt
\family default
' file in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
binmin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Standard
The control variables bulding the vectors 
\begin_inset Formula $\mathbf{k}_{i}$
\end_inset

 are actived setting to '
\family typewriter
1
\family default
' the following parameters in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file,
\end_layout

\begin_layout Itemize
<
\family typewriter
c_manning
\family default
> for the Manning-Strickler roughness coefficient and written in the 'manning.xxx
' output result files.
\end_layout

\begin_layout Itemize
<
\family typewriter
c_bathy
\family default
> for the bed elevation and written in the bathy.xxx' output result files.
\end_layout

\begin_layout Itemize
<
\family typewriter
c_ic
\family default
> for the initial condition and written in the 'ic.xxx' output result files.
\end_layout

\begin_layout Itemize
<
\family typewriter
c_hydrograph
\family default
> for the hydrograph(s) and written in the 'hydograph_yyy.xxx' output result
 files.
\end_layout

\begin_layout Itemize
<
\family typewriter
c_ratcurve
\family default
> for the rating curve(s) and written in the 'ratcurve_yyy.xxx' output result
 files.
\end_layout

\begin_layout Standard
The identification process could be very long in time and the <
\family typewriter
restart_min
\family default
> parameter in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file can be setted to the maximum number of iterations to perform.
 A file '
\family typewriter
restart_min.bin
\family default
' is generated at each iteration and is read if it exists to restart the
 identification process.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Simple Practice Case
\end_layout

\begin_layout Standard
It is presented here a simple tutorial test case showing how to use the
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software step by step.
 The case of simulation is saved in the directory 
\family typewriter
\series bold
simu/sw_mono/channel_adj
\family default
\series default
.
 It is a simple rectangular channel with a constant slope perturbated by
 sinuous waves.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_topo.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Rectangular channel bed elevation.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Forward solver
\end_layout

\begin_layout Standard
In order to use the direct solver, one must follow these steps :
\end_layout

\begin_layout Enumerate
Copy the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 files from the 
\family typewriter
\series bold
simu/sw_mono/channel_adj
\family default
 
\series default
directory to the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Enumerate
Choose compilation options in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

 and compile/link the executable called 
\family typewriter
\series bold

\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
exe{}
\end_layout

\end_inset


\family default
\series default
 and placed in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory typing the command '
\family typewriter
make
\family default
'.
\end_layout

\begin_layout Enumerate
Run the direct solver using the command '
\family typewriter
make runexe
\family default
', or directly ./'
\family typewriter
exe
\family default
' in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bin{}
\end_layout

\end_inset

 directory.
\end_layout

\begin_layout Enumerate
Check the result files in the 
\family typewriter
\series bold
bin/res
\family default
\series default
 directory.
\end_layout

\begin_layout Subsection
Adjoint solver
\end_layout

\begin_layout Standard
In order to use the adjoint solver, one must follow these steps :
\end_layout

\begin_layout Enumerate
Set to '
\family typewriter
1
\family default
' the ADJOINT parameter in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
make{}
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
Generate the adjoint Fortran program files running the command '
\family typewriter
make tap_files
\family default
' (Tapenade must be installed with appropriate Java).
\end_layout

\begin_layout Enumerate
Compile the executable by running the command '
\family typewriter
make
\family default
'.
\end_layout

\begin_layout Enumerate
Copy the observation files from the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
binres{}
\end_layout

\end_inset

 directory into a new directory 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
binobs{}
\end_layout

\end_inset

 in order to use it setting to '
\family typewriter
1
\family default
' the option <
\family typewriter
\series bold
use_obs
\family default
\series default
> in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file.
\end_layout

\begin_layout Enumerate
Change the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file by a new file (
\family typewriter
\series bold
hydrograph_first_guess.txt
\family default
\series default
).
\end_layout

\begin_layout Enumerate
We have the choice to compute the cost function using the command '
\family typewriter
make runexe
\family default
', to calculte its gradient using the command '
\family typewriter
make rungrad
\family default
' or to minimize it using the command '
\family typewriter
make runmin
\family default
'.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_qin_qout.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/channel_obs.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
(left) Imposed hydrograph ; (right) Resulting water depth observed in time
 at stations 1 & 2.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_grad_bathy.pdf
	lyxscale 60
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Topography gradient.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_grad_manning.pdf
	lyxscale 60
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Manning's roughness coefficient gradient.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_cost_ident_qin.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/channel_ident_qin.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Identification of Qin : (left) File min_cost.txt; (right) Evolution of Qin
 with iterations of minimization.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Numerical schemes
\end_layout

\begin_layout Standard
In this section, we describe the numerical methods based on a Finite Volume
 approach solving the Shallow water model implemented in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software.
\end_layout

\begin_layout Subsection
Preliminaries
\end_layout

\begin_layout Standard
Following the formalism of the Finite Volume method, we introduce a discretizati
on 
\begin_inset Formula $\text{ℑ}_{h}$
\end_inset

 of a computational domain 
\begin_inset Formula $\Omega$
\end_inset

 with 
\begin_inset Formula $N$
\end_inset

 cells 
\begin_inset Formula $K_{i}$
\end_inset

 (cells can be triangles or quadrilaterals that can be also mixed in practice).
 Let us to introduce some notations and conventions (see Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mesh"

\end_inset

), considering a given cell 
\begin_inset Formula $K$
\end_inset

 (omitting above 
\begin_inset Formula $i$
\end_inset

 index),
\end_layout

\begin_layout Itemize
\begin_inset Formula $m_{K}$
\end_inset

 is the area of the cell 
\begin_inset Formula $K$
\end_inset

, 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $m_{\partial K}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 its perimeter and 
\begin_inset Formula $x_{K}$
\end_inset

 its barycenter.
\end_layout

\begin_layout Itemize
\begin_inset Formula $e$
\end_inset

 is one of the 
\begin_inset Formula $\delta K$
\end_inset

 boundary edges, 
\begin_inset Formula $m_{e}$
\end_inset

 its length and 
\begin_inset Formula $x_{e}$
\end_inset

 its center.
\end_layout

\begin_layout Itemize
\begin_inset Formula $K_{e}$
\end_inset

 is the neighboring cell to 
\begin_inset Formula $K$
\end_inset

 across 
\begin_inset Formula $e$
\end_inset

.
\end_layout

\begin_layout Itemize
\begin_inset Formula $\mathbf{n}_{e,K}$
\end_inset

 is the unit normal to 
\begin_inset Formula $e$
\end_inset

 oriented from 
\begin_inset Formula $K$
\end_inset

 to 
\begin_inset Formula $K_{e}$
\end_inset

.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/mesh.svg
	lyxscale 50
	width 25text%

\end_inset

 
\begin_inset Caption Standard

\begin_layout Plain Layout
Notations and conventions for mesh discretization and numerical schemes
 associated.
\begin_inset CommandInset label
LatexCommand label
name "fig:mesh"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The Shallow Water equations are rewritten in conservative form as follows,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\text{\ensuremath{\partial}}_{t}\mathbf{U}+\text{\ensuremath{\partial}}_{x}\mathbf{F}(\mathbf{U})+\text{\ensuremath{\partial}}_{y}\mathbf{G}(\mathbf{U})\:=\:\mathbf{S}_{g}(\mathbf{U})+\mathbf{S}_{f}(\mathbf{U})\\
\\
\begin{array}{c}
\mathbf{U}=\begin{bmatrix}h\\
hu\\
hv
\end{bmatrix}\:,\:\mathbf{F}(\mathbf{U})=\begin{bmatrix}hu\\
hu^{2}+{\displaystyle \frac{gh^{2}}{2}}\\
huv
\end{bmatrix}\:,\:\mathbf{G}(\mathbf{U})=\begin{bmatrix}hv\\
huv\\
hv^{2}+{\displaystyle \frac{gh^{2}}{2}}
\end{bmatrix}\:,\\
\\
\mathbf{S}_{g}(\mathbf{U})=\begin{bmatrix}0\\
-gh\mathbf{\nabla}z_{b}
\end{bmatrix}\:,\:\mathbf{S}_{f}(\mathbf{U})=\begin{bmatrix}0\\
-g{\displaystyle \frac{n^{2}\left\Vert \mathbf{u}\right\Vert }{h^{1/3}}}\mathbf{u}
\end{bmatrix}
\end{array}
\end{array}\label{eq:sw_cons}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
We introduce the piecewise constant approximation over mesh cells,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}={\displaystyle \frac{1}{m_{K}}}\int_{K}\mathbf{U}dK
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Schemes for conservative fluxes 
\end_layout

\begin_layout Subsubsection
First order scheme
\end_layout

\begin_layout Standard
Integrating over the cell 
\begin_inset Formula $K$
\end_inset

 the hyperbolic system of partial differential equations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sw_cons"

\end_inset

) without the source terms 
\begin_inset Formula $\mathbf{S}_{g}$
\end_inset

 and 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 and noting 
\begin_inset Formula $\mathbf{U}_{K}^{n}$
\end_inset

 and 
\begin_inset Formula $\mathbf{U}_{K}^{n+1}$
\end_inset

 the piecewise constant approximation of 
\begin_inset Formula $\mathbf{U}$
\end_inset

 at time 
\begin_inset Formula $t^{n}$
\end_inset

 and 
\begin_inset Formula $t^{n+1}$
\end_inset

 (with 
\begin_inset Formula $t^{n+1}=t^{n}+\Delta t^{n}$
\end_inset

), and applying the Godunov method 
\begin_inset CommandInset citation
LatexCommand cite
key "Godunov1959"
literal "true"

\end_inset

, the semi-discrete scheme for the homogeneous system can be written as
 follows,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\mathbf{U}_{K}^{n}-{\displaystyle \frac{\Delta t^{n}}{m_{K}}\sum_{e\in\partial K}m_{e}}\mathbf{F}_{e}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K})\label{eq:semi-discrete}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The rotational invariance property of the shallow water equations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sw_cons"

\end_inset

) allows to reduce this sum of 2D problem to a sum of 1D local Riemann problems
 such that 
\begin_inset Formula $\mathbf{F}_{e}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K})=\mathbf{R}_{e,K}^{-1}\hat{\mathbf{F}_{e}}(\mathbf{\hat{U}}_{e,K}^{n},\mathbf{\hat{U}}_{e,K_{e}}^{n})$
\end_inset

 with 
\begin_inset Formula $\mathbf{\hat{U}}_{e,K}^{n}=\mathbf{R}_{e,K}\mathbf{U}_{K}^{n}$
\end_inset

 where 
\begin_inset Formula $\mathbf{R}_{e,K}$
\end_inset

 is the rotation matrix, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Toro2001"
literal "true"

\end_inset

.
 The HLLC approximate Riemann solver is used,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
\begin{array}{c}
\left[\mathbf{\hat{F}}_{e}^{HLLC}\right]_{1,2}={\displaystyle \frac{s_{K_{e}}\left[\mathbf{F}(\hat{\mathbf{U}}_{K})\right]_{1,2}-s_{K}\left[\mathbf{F}(\hat{\mathbf{U}}_{K_{e}})\right]_{1,2}+s_{K}s_{K_{e}}(\left[\hat{\mathbf{U}}_{K_{e}}\right]_{1,2}-\left[\hat{\mathbf{U}}_{K}\right]_{1,2})}{s_{K_{e}}-s_{K}}}\end{array}\\
\left[\mathbf{\hat{F}}_{e}^{HLLC}\right]_{3}=\left[\mathbf{\hat{F}}_{e}^{HLLC}\right]_{1}\hat{v}*\quad\text{with}\quad\hat{v}*=\left\{ \begin{array}{c}
\hat{v}_{K}\quad\text{if}\quad s^{*}\geq0\\
\hat{v}_{K_{e}}\quad\text{if}\quad s^{*}<0
\end{array}\right.
\end{array}\right.\label{eq:hllc}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with the wave speed estimates due to J.-P.
 Vila 
\begin_inset CommandInset citation
LatexCommand cite
key "Vila1986"
literal "true"

\end_inset

, 
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
s_{K}=\min\left(0,\hat{u}_{K}-\sqrt{gh_{K}},\hat{u}_{K_{e}}-2\sqrt{gh_{K_{e}}}+\sqrt{gh_{K}}\right)\\
s_{K_{e}}=\max\left(0,\hat{u}_{K_{e}}+\sqrt{gh_{K_{e}}},\hat{u}_{K}+2\sqrt{gh_{K}}-\sqrt{gh_{K_{e}}}\right)
\end{array}\label{eq:hll_waves}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
as it has been demonstrated that it insures 
\begin_inset Formula $L^{\infty}$
\end_inset

 stability, positivity and consistency with entropy condition under a CFL
 condition.
 This choice is made for the intermediate wave speed estimate, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Toro2001"
literal "true"

\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
s^{*}={\displaystyle \frac{s_{K}h_{K_{e}}\hat{u}_{K_{e}}-s_{K_{e}}h_{K}\hat{u}_{K}-s_{K}s_{K_{e}}(h_{K_{e}}-h_{K})}{h_{K_{e}}(\hat{u}_{K_{e}}-s_{K_{e}})-h_{K}(\hat{u}_{K}-s_{K})}}\label{eq:c_wave}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The CFL-like condition for the time step 
\begin_inset Formula $\Delta t^{n}$
\end_inset

 is, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Vila2003"
literal "true"

\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta t^{n}=c\;\min_{K\in\Omega}{\displaystyle \left(\frac{2\;m_{K}}{m_{\partial K}\left(\left\Vert \mathbf{u}_{K}^{n}\right\Vert +\sqrt{gh_{K}^{n}}\right)}\right)}\label{eq:time-step}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with a constant 
\begin_inset Formula $c\in[0.5,0.8]$
\end_inset

 in practice.
 For numerical purpose, the eventual round-off error generating a negative
 water depth is elimitated at the end of the time step 
\begin_inset Formula $h_{K}^{n+1}=\max(0,h_{K}^{n+1})$
\end_inset

.
 A small cut-off water depth 
\begin_inset Formula $h_{\epsilon}$
\end_inset

 is also eventually introduced bellow which the velocity components are
 setted to zero in order to stabilize the numerical model.
 This cut-off has been found however seldom required with used HLLC flux
 and is generally fixed to machine epsilon.
\end_layout

\begin_layout Subsubsection
Second order scheme
\end_layout

\begin_layout Standard
A monoslope second order MUSCL scheme, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Chevrier1993,Buffard2010"
literal "true"

\end_inset

, consists in local linear reconstructions by calculating a vectorial slope
 
\begin_inset Formula $\left[\mathbf{\nabla}\mathbf{U}_{K}^{n}\right]_{i}$
\end_inset

 in each cell 
\begin_inset Formula $K$
\end_inset

 for each variable 
\begin_inset Formula $i$
\end_inset

 such that the two reconstructed conservative variables vectors 
\begin_inset Formula $\mathbf{U}_{e,K}^{n}$
\end_inset

 and 
\begin_inset Formula $\mathbf{U}_{e,K_{e}}^{n}$
\end_inset

 at each side of edge 
\begin_inset Formula $e$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\mathbf{U}_{e,K}^{n}=\mathbf{U}_{K}^{n}+\mathbf{\nabla}\mathbf{U}_{K}^{n}.\mathbf{x}_{K}\mathbf{x}_{e}\\
\mathbf{U}_{e,K_{e}}^{n}=\mathbf{U}_{K_{e}}^{n}+\mathbf{\nabla}\mathbf{U}_{K_{e}}^{n}.\mathbf{x}_{K_{e}}\mathbf{x}_{e}
\end{array}\label{eq:muscl_recons_vector}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
replace 
\begin_inset Formula $\mathbf{U}_{K}^{n}$
\end_inset

 and 
\begin_inset Formula $\mathbf{U}_{K_{e}}^{n}$
\end_inset

 in the original first order semi-discrete scheme (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete"

\end_inset

) to evaluate the numerical flux 
\begin_inset Formula $\mathbf{F}_{e}$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\mathbf{U}_{K}^{n}-{\displaystyle \frac{\Delta t^{n}}{m_{K}}\sum_{e\in\partial K}m_{e}}\mathbf{F}_{e}(\mathbf{U}_{e,K}^{n},\mathbf{U}_{e,K_{e}}^{n},\mathbf{n}_{e,K})\label{eq:semi-dicrete-muscl}
\end{equation}

\end_inset


\end_layout

\begin_layout Paragraph
Predicted slope
\end_layout

\begin_layout Standard
With a such linear reconstruction, one can expect a scheme with a second-order
 accuracy in space (for sufficient regular solutions).
 To this end, a least square method is first employed to predict the vectorial
 slopes for each primitive variable (
\begin_inset Formula $\mathbf{W}_{K}^{n}=\left[\ h_{K}^{n}\ u_{K}^{n}\ v_{K}^{n}\ \right]^{T}$
\end_inset

).
 These sums of squares,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
E_{i}\left(\left[\widetilde{\mathbf{\nabla}\mathbf{W}_{K}^{n}}\right]_{i}\right)={\displaystyle \sum_{e\in\partial K}\left(\left[\mathbf{W}_{K_{e}}^{n}\right]_{i}-\left(\left[\mathbf{W}_{K}^{n}\right]_{i}+\left[\mathbf{\nabla}\mathbf{W}_{K}^{n}\right]_{i}.\mathbf{x}_{K}\mathbf{x}_{K_{e}}\right)\right)^{2}}\end{array}\label{eq:ls_muscl}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
are minimized by setting the gradients to zero solution of simple 2 x 2
 linear systems.
 This method represents a good alternative among others to find the hyperplane
 
\begin_inset CommandInset citation
LatexCommand cite
key "Chevrier1993,Haider2009"
literal "true"

\end_inset

 because of its accuracy and robustness independently to the number of neighbour
s (an important property as it will be shown later with our wet/dry front
 treatment for a well-balanced scheme).
\end_layout

\begin_layout Paragraph
Limitating procedure
\end_layout

\begin_layout Standard
In order to prevent from large numerical dispersive instabilities, the predicted
 vectorial slopes need to be limited.
 A first and efficient method consists to simply apply the maximum principle
 to the two edge unlimited reconstructed primitive variable calculated from
 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:muscl_recons_vector"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ls_muscl"

\end_inset

) such that the two employed limited reconstructed variables 
\begin_inset Formula $\mathbf{W}_{e,K}^{n}$
\end_inset

 and 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\mathbf{W}_{e,K_{e}}^{n}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 at edge 
\begin_inset Formula $e$
\end_inset

 verify,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\min(\mathbf{W}_{K}^{n},\mathbf{W}_{K_{e}}^{n})\leq\mathbf{W}_{e,K}^{n},\mathbf{W}_{e,K_{e}}^{n}\leq\max(\mathbf{W}_{K}^{n},\mathbf{W}_{K_{e}}^{n})
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
what we call the MP limiter (for Maximum Principle).
 We observe in practice that it generates very moderate oscillations at
 solution singularities whereas diffusion is minimized comparatively to
 other classic limiters like Minmod or Van Albada, see also e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2005,Nikolos2009,Delis2011,Delis2013"
literal "true"

\end_inset

.
 Nevertheless, generation of new extremas and the presence of
\shape italic
 wet/dry fronts
\shape default
 can break the Finite Volume mass conservation property in unacceptable
 proportion (the scheme is no longer positive).
 A first solution is to manage 
\begin_inset Quotes eld
\end_inset

by hand
\begin_inset Quotes erd
\end_inset

 the mass conservation at the end of each time step.
 The mass artificially added cutting-off to zero an eventual negative water
 depth is removed proportionally to neighboring wet cells.
 A second solution is to use the Barth limiter 
\begin_inset CommandInset citation
LatexCommand cite
key "Barth2003"
literal "true"

\end_inset

 for the water depth 
\begin_inset Formula $h$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
{\displaystyle \left[\mathbf{\nabla}\mathbf{W}_{K}^{n}\right]_{i}=\min_{e\in\partial K}\left(1,\left[\phi_{K,e}\right]_{i}\right)\left[\widetilde{\mathbf{\nabla}\mathbf{W}_{K}^{n}}\right]_{i}}\\
\\
{\displaystyle \left[\phi_{K,e}\right]_{i}=}\left\{ \begin{array}{cl}
0 & \ \text{if}\ {\displaystyle \left(\left[\mathbf{W}_{K_{e}}^{n}\right]_{i}-\left[\mathbf{W}_{K}^{n}\right]_{i}\right)}{\displaystyle \left[\mathbf{\nabla}\mathbf{W}_{K}^{n}\right]_{i}.\mathbf{x}_{K}\mathbf{x}_{e}<0}\\
{\displaystyle \frac{{\displaystyle \left[\mathbf{W}_{K_{e}}^{n}\right]_{i}-\left[\mathbf{W}_{K}^{n}\right]_{i}}}{\left[\mathbf{\nabla}\mathbf{W}_{K}^{n}\right]_{i}.\mathbf{x}_{K}\mathbf{x}_{e}}} & \ \text{if not}
\end{array}\right.
\end{array}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The reconstructed conservative variables vectors 
\begin_inset Formula $\mathbf{U}_{K}^{n}$
\end_inset

 and 
\begin_inset Formula $\mathbf{U}_{K_{e}}^{n}$
\end_inset

 are then obtained by a simple multiplication.
\end_layout

\begin_layout Subsection
Well-balanced schemes with wet/dry front treatment
\end_layout

\begin_layout Standard
If previous schemes are used with a naive topography gradient 
\begin_inset Formula $\nabla z_{b}$
\end_inset

 discretization in the gravity source term 
\begin_inset Formula $\mathbf{S}_{g}(\mathbf{U})$
\end_inset

 to perform real data simulations with large topography gradients (typically
 perpendicular to the streamlines), it is well know that it produces unacceptabl
e numerical spurious velocities (citations).
 The reason is that there is no discrete balance between the hydrostatic
 pressure and the gravity source term (
\begin_inset Formula ${\displaystyle \nabla\left(gh^{^{2}}/2\right)\neq-gh\nabla z_{b}}$
\end_inset

).
 We present here two methods to enforce this balance property.
 A first one part of the class of well-balanced schemes of Chacón Rebollo
 and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "ChaconRebollo2004,CastroDiaz2008"
literal "true"

\end_inset

.
 And as this method has been found stable only at first order, we present
 also the second order well-balanced scheme due to Audusse and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2004,Audusse2005"
literal "true"

\end_inset

 with a wet/dry front treatment (the first order version is obvious, no
 special wet/dry treatment is needed).
\end_layout

\begin_layout Subsubsection
E-well-balanced scheme
\end_layout

\begin_layout Standard
In order to build a well-balanced scheme, these equalities must be verified
 when 
\begin_inset Formula $z_{K}+h_{K}=z_{K_{e}}+h_{K_{e}}$
\end_inset

 and 
\begin_inset Formula $\mathbf{u}_{K}=\mathbf{u}_{K_{e}}=0$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{rcl}
\mathbf{F}_{e}^{h}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K}) & = & 0\\
{\displaystyle \sum_{e\in\partial K}}m_{e}\mathbf{F}_{e}^{h\mathbf{u}}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K}) & = & -g{\displaystyle \sum_{e\in\partial K}}m_{e}h_{e}(z_{e}-z_{K})\mathbf{n}_{e,K}
\end{array}\label{eq:wb-E-eq}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
using the property 
\begin_inset Formula $h\nabla z_{b}=\nabla(hz_{b})-z_{b}\nabla h$
\end_inset

 and the Green's identity to find the piecewise constant approximation of
 
\begin_inset Formula $\mathbf{S}_{g}(\mathbf{U})$
\end_inset

 incorporated in semi-discrete scheme (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete"

\end_inset

).
 One has now to find 
\begin_inset Formula $h_{e}$
\end_inset

 and 
\begin_inset Formula $z_{e}$
\end_inset

, reconstructions at edge 
\begin_inset Formula $e$
\end_inset

 of the water depth and the topography respectively, to derive a well-balanced
 scheme with a consistant discretization of the gravitational source term
 
\begin_inset Formula $\mathbf{S}_{g}(\mathbf{U})$
\end_inset

.
 Because of the geometrical property 
\begin_inset Formula ${\displaystyle \sum_{e\in\partial K}}m_{e}\mathbf{n}_{e,K}=0$
\end_inset

, 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
the term 
\begin_inset Formula $\mathbf{F}_{e}^{h\mathbf{u}}(\mathbf{U}_{K}^{n},\mathbf{U}_{K}^{n},\mathbf{n}_{e,K})$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 can be subtracted in the first sum.
 After some calculations and by identification, one can easily verify using
 the HLLC approximate Riemann solver (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hllc"

\end_inset

) to evaluate 
\begin_inset Formula $\mathbf{F}_{e}$
\end_inset

 that these two reconstructions give the second equality in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wb-E-eq"

\end_inset

),
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
z_{e}={\displaystyle \frac{1}{2}}\left(z_{K}+z_{K_{e}}\right)\quad\text{and}\quad h_{e}={\displaystyle \frac{s_{K}}{s_{K_{e}}-s_{K}}}\left(h_{K}+h_{K_{e}}\right)\label{eq:wb-E-edge}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
To find a zero mass flux, the water depths 
\begin_inset Formula $h_{K}$
\end_inset

 and 
\begin_inset Formula $h_{K_{e}}$
\end_inset

 in the diffuse upwinded part of the HLLC approximate Riemann solver are
 replaced by 
\begin_inset Formula $z_{K}+h_{K}$
\end_inset

 and 
\begin_inset Formula $z_{K_{e}}+h_{K_{e}}$
\end_inset

.
 At wet/dry fronts, the bottom topography is changed in a dry cell 
\begin_inset Formula $K_{e}$
\end_inset

 such that 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $z_{K_{e}}=$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula $z_{K}+h_{K}$
\end_inset

.
 This numerical method can be extend to second-order taking into account
 the reconstruted water depths at edge 
\begin_inset Formula $e$
\end_inset

 but it has not been found stable in all cases.
 More generally, changing the diffuse upwinded part of the HLLC approximate
 Riemann solver cannot ensure a stable numerical model.
\end_layout

\begin_layout Subsubsection
A-well-balanced scheme
\end_layout

\begin_layout Standard
Following the method of Audusse and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2004,Audusse2005"
literal "true"

\end_inset

, a new vectorial slope for the variable 
\begin_inset Formula $\eta=h+z$
\end_inset

 is first calculated in addition to primitive variables ones (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:muscl_recons_vector"

\end_inset

).
 Then, the so-called hydrostatic reconstructed water depth 
\begin_inset Formula $h_{e,K}^{*}$
\end_inset

 is defined with the help of a reconstructed topography 
\begin_inset Formula $z_{e}$
\end_inset

 at edge 
\begin_inset Formula $e$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
h_{e,K}^{*}=\max(0,h_{e,K}+z_{e,K}-z_{e})\\
\text{with}\quad\left\{ \begin{array}{c}
z_{e,K}=\eta_{e,K}-h_{e,K}\\
z_{e}=\max\left(z_{e,K},z_{e,K_{e}}\right)
\end{array}\right.
\end{array}\label{eq:hydrostatic_h_1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The standard MUSCL reconstructed conservative variable vector 
\begin_inset Formula $\mathbf{U}_{e,K}^{n}$
\end_inset

 in semi-discrete scheme (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-dicrete-muscl"

\end_inset

) is replaced by,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{e,K}^{*}=\begin{bmatrix}h_{e,K}^{*}\\
h_{e,K}^{*}\mathbf{u}
\end{bmatrix}\label{eq:hydrostatic_h_2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Including a consistant discretization of the gravitationnal source term
 
\begin_inset Formula $\mathbf{S}_{g}$
\end_inset

 with the continuous formulation, we finally obtain a well-balanced scheme
 at second order,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\mathbf{U}_{K}^{n+1}=\mathbf{U}_{K}^{n}-{\displaystyle \frac{\Delta t^{n}}{m_{K}}\sum_{e\in\partial K}m_{e}}\left(\;\mathbf{F}_{e}(\mathbf{U}_{e,K}^{*n},\mathbf{U}_{e,K_{e}}^{*n},\mathbf{n}_{e,K})+\right.\\
\left.\mathbf{S}_{g}(\mathbf{U}_{e,K}^{n},\mathbf{U}_{e,K}^{*n},\mathbf{n}_{e,K})+\mathbf{S}_{g}^{c}(\mathbf{U}_{K}^{n},\mathbf{U}_{e,K}^{n},z_{K},z_{e,K},\mathbf{n}_{e,K})\;\right)\\
\\
\mathbf{S}_{g}(\mathbf{U}_{e,K}^{n},\mathbf{U}_{e,K}^{*n},\mathbf{n}_{e,K})=\begin{bmatrix}0\\
{\displaystyle \frac{g}{2}}\left(\left(h_{e,K}^{n*}\right)^{2}-\left(h_{e,K}^{n}\right)^{2}\right)\mathbf{n}_{e,K}
\end{bmatrix}\\
\\
\mathbf{S}_{g}^{c}(\mathbf{U}_{K}^{n},\mathbf{U}_{e,K}^{n},z_{K},z_{e,K},\mathbf{n}_{e,K})=\begin{bmatrix}0\\
-{\displaystyle \frac{g}{2}}\left(h_{e,K}^{n}+h_{K}^{n}\right)\left(z_{e,K}-z_{K}\right)\mathbf{n}_{e,K}
\end{bmatrix}
\end{array}\label{eq:semi-discrete-wb}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Our numerical experiments showed that this scheme is not stable at wet/dry
 fronts perpendicular to the flow streamlines.
 Let us specify here some additional requirements in order to stabilize
 in all cases and for all limiters this second order well-balanced scheme.
 Firstly, all vectorial slopes are enforced to zero in dry cells (what can
 be viewed as a mask in practice) .
 Secondly, these same dry cells are not taken into account in the least
 square method (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ls_muscl"

\end_inset

) to predict the vectorial slope 
\begin_inset Formula $\nabla\eta^{n}$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\left[\mathbf{\nabla}\mathbf{U}_{K}^{n}\right]_{i}=\mathbf{0}\quad\text{if}\quad h_{K}=0\\
\\
E(\mathbf{\nabla}\eta_{K}^{n})=\underset{e\in\left(\partial K\backslash h_{K_{e}}=0\right)}{\sum}\left(\mathbf{\eta}_{K_{e}}^{n}-\left(\eta_{K}^{n}+\mathbf{\nabla}\eta_{K}^{n}.\mathbf{x}_{K}\mathbf{x}_{K_{e}}\right)\right)^{2}
\end{array}\label{eq:wb-wet/dry}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
These conditions are related to the typical situation in Fig.(
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:typical-wb-wet/dry"

\end_inset

) where the well-balanced property is desired with presence of a wet/dry
 front because the water surface level 
\begin_inset Formula $\eta$
\end_inset

 is constant around the cell 
\begin_inset Formula $K$
\end_inset

.
 The dry cell 
\begin_inset Formula $K_{e}$
\end_inset

 has a bottom topography 
\begin_inset Formula $z_{K_{e}}$
\end_inset

 upper than the neibgboring wet cell 
\begin_inset Formula $K$
\end_inset

 water surface level 
\begin_inset Formula $\eta_{K}$
\end_inset

, the fluxes must be enforced to zero at the edge 
\begin_inset Formula $e$
\end_inset

 between the two cells (water cannot 
\begin_inset Quotes eld
\end_inset

climb
\begin_inset Quotes erd
\end_inset

 in this situation) and the well-balanced property must be verified in the
 cell 
\begin_inset Formula $K$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/wb-wet-dry.svg
	lyxscale 40
	width 40text%

\end_inset

 
\begin_inset Caption Standard

\begin_layout Plain Layout
Typical situation of desired well-balanced property in presence of a wet/dry
 front.
\begin_inset CommandInset label
LatexCommand label
name "fig:typical-wb-wet/dry"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Making the hypothesis that the normal velocity 
\begin_inset Formula $\hat{u}_{e,K}$
\end_inset

 is not necessary zero, a simple way to enforce 
\begin_inset Formula $\mathbf{F}_{e}(\mathbf{U}_{e,K}^{*n},\mathbf{U}_{e,K_{e}}^{*n},\mathbf{n}_{e,K})$
\end_inset

 in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete-wb"

\end_inset

) to be zero is for the reconstructed hydrostatic water depths 
\begin_inset Formula $h_{e,K}^{*}$
\end_inset

 and 
\begin_inset Formula $h_{e,K_{e}}^{*}$
\end_inset

 to be always zero (we remark that it is effectively always true for the
 first order version of the scheme since
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
 
\begin_inset Formula $z_{e}=\max\left(z_{K},z_{K_{e}}\right)=z_{K_{e}}>h_{K}+z_{K}$
\end_inset

, 
\begin_inset Formula $h_{e,K}^{*}=\max\left(0,h_{K}+z_{K}-z_{e}\right)=0$
\end_inset

 and 
\begin_inset Formula $h_{e,K_{e}}^{*}=\max\left(0,h_{K_{e}}+z_{K_{e}}-z_{e}\right)=0$
\end_inset

).
 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
On other side, a key-point in the second order well-balanced method of Audusse
 and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2004,Audusse2005"
literal "true"

\end_inset

 is that the vectorial slope for the variable 
\begin_inset Formula $\eta=h+z$
\end_inset

 must be zero to find the well-balanced property in a cell 
\begin_inset Formula $K$
\end_inset

.
 The variable 
\begin_inset Formula $\eta$
\end_inset

 must be constant in all neighboring cells of a wet cell which is not true
 in our typical case Fig.(
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:typical-wb-wet/dry"

\end_inset

) .
 So, in order to find a zero vectorial slope for the variable 
\begin_inset Formula $\eta$
\end_inset

 in the cell 
\begin_inset Formula $K$
\end_inset

, the dry cell 
\begin_inset Formula $K_{e}$
\end_inset

 is not taken into account in the least square method (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ls_muscl"

\end_inset

).
 Now, a consequence is that 
\begin_inset Formula $\eta_{e,K}=h_{K}+z_{K}<\eta_{e,K_{e}}=z_{e,K_{e}}$
\end_inset

 implying that 
\begin_inset Formula $z_{e}=\max\left(z_{e,K},z_{e,K_{e}}\right)=z_{e,K_{e}}$
\end_inset

 and concluded that it is always find that 
\begin_inset Formula $h_{e,K}^{*}=\max(0,\eta_{e,K}-z_{e})=0$
\end_inset

.
 Since all vectotorial slopes are enforced to zero in dry cells, it is obvious
 that we have also 
\begin_inset Formula $h_{e,K_{e}}^{*}=0$
\end_inset

.
 The sum of the non negative components of the two sources terms 
\begin_inset Formula $\mathbf{S}_{g}(\mathbf{U}_{K}^{n},\mathbf{U}_{e,K}^{*n},\mathbf{n}_{e,K})$
\end_inset

 and 
\begin_inset Formula $\mathbf{S}_{g}^{c}(\mathbf{U}_{K}^{n},\mathbf{U}_{e,K}^{*n},z_{K},z_{e,K},\mathbf{n}_{e,K})$
\end_inset

 is reduce to 
\begin_inset Formula $-{\displaystyle \frac{g}{2}h_{K}^{2}\mathbf{n}_{e,K}}$
\end_inset

 because 
\begin_inset Formula $z_{e,K}-z_{K}=h_{K}-h_{e,K}$
\end_inset

 and it do not change the demonstration in 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2005"
literal "true"

\end_inset

 to find the well-balanced property in the cell 
\begin_inset Formula $K$
\end_inset

 (that use the geometrical property 
\begin_inset Formula ${\displaystyle \sum_{e\in\partial K}}m_{e}\mathbf{n}_{e,K}=0$
\end_inset

).
\end_layout

\begin_layout Standard
So, we have demonstrated that our additional requirements (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:wb-wet/dry"

\end_inset

) to the original scheme (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete-wb"

\end_inset

) are sufficient to find the well-balanced property in presence of wet/dry
 interfaces without any consideration on limitation such it is done before.
 And it do not change the global scheme at wet/dry fronts because we only
 manipulate the predicted vectorial slopes.
 The scheme 
\begin_inset Quotes eld
\end_inset

falls at worst
\begin_inset Quotes erd
\end_inset

 at the first order in the cells with a neigboring dry cell.
\end_layout

\begin_layout Subsection
Time stepping and friction source term implicitation
\end_layout

\begin_layout Standard
The friction source term 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 can be discretized in time using a splitting approach, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Quarteroni2008,Toro2001"
literal "true"

\end_inset

.
 Noting 
\begin_inset Formula $\bar{\mathbf{U}}_{K}^{n+1}$
\end_inset

 the previous solution at time 
\begin_inset Formula $t^{n+1}$
\end_inset

 relative to the well-balanced schemes at first and second order including
 a consistant discretization of the gravitationnal source term 
\begin_inset Formula $\mathbf{S}_{g}$
\end_inset

 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete-wb"

\end_inset

), the semi-implicit scheme including the friction source term 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 in the discretization of the model (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:sw_cons"

\end_inset

) can be written in a general form as,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\mathbf{\bar{U}}_{K}^{n+1}+\Delta t^{n}\mathbf{S}_{f}(\mathbf{\bar{U}}_{K}^{n+1},\mathbf{U}_{K}^{n+1})\label{eq:semi-implicit-friction}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Since the friction source term 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 is zero in the mass conservation equation, we remark that 
\begin_inset Formula $h^{n+1}=\bar{h}^{n+1}$
\end_inset

 simplifying the development of a semi-implicit scheme.
 Now, in order to avoid the possible numerical instabilities at wet/dry
 fronts induced by the presence of 
\begin_inset Formula $h^{1/3}$
\end_inset

 at denominator in 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 expression, one should introduce the 
\begin_inset Quotes eld
\end_inset

highest level
\begin_inset Quotes erd
\end_inset

 of implicitation in (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-implicit-friction"

\end_inset

) and after some developments, this final expression can be derived,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\begin{bmatrix}\begin{array}{c}
\bar{h}^{n+1}\\
h^{n+1}\;\bar{\mathbf{u}}^{n+1}\left({\displaystyle \frac{\left(h^{n+1}\right)^{4/3}}{\left(h^{n+1}\right)^{4/3}+\Delta t^{n}\;g\;n^{2}\;\left\Vert \mathbf{\bar{u}}^{n+1}\right\Vert }}\right)
\end{array}\end{bmatrix}\label{eq:fric-classic}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Liang and Marche 
\begin_inset CommandInset citation
LatexCommand cite
key "Liang2009"
literal "true"

\end_inset

 have derived a very similar expression by linearization of the full implicit
 method,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\begin{bmatrix}\begin{array}{c}
\bar{h}^{n+1}\\
h^{n+1}\;\bar{\mathbf{u}}^{n+1}\left({\displaystyle \frac{\left(h^{n+1}\right)^{4/3}+\Delta t^{n}\;g\;n^{2}\;\left\Vert \mathbf{\bar{u}}^{n+1}\right\Vert }{\left(h^{n+1}\right)^{4/3}+2\Delta t^{n}\;g\;n^{2}\;\left\Vert \mathbf{\bar{u}}^{n+1}\right\Vert }}\right)
\end{array}\end{bmatrix}\label{eq:fric-marche}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
But the full implicit problem that can be written in this form,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\Vert \mathbf{u}^{n+1}\right\Vert \mathbf{u}^{n+1}+c\left(\mathbf{u}^{n+1}-\bar{\mathbf{u}}^{n+1}\right)=0\quad\text{with}\quad c={\displaystyle \frac{2\ \left(h^{n+1}\right)^{4/3}}{g\ n^{2}\ \Delta t^{n}}}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
has an exact solution.
 Remarking that 
\begin_inset Formula $\mathbf{u}^{n+1}=\alpha\ \bar{\mathbf{u}}^{n+1}$
\end_inset

 with 
\begin_inset Formula $\alpha\in]0,1[$
\end_inset

 reduce this system of non-linear equations to the resolution of a quadratic
 equation in 
\begin_inset Formula $\alpha$
\end_inset

.
 The final analytical solution is,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\mathbf{U}_{K}^{n+1}=\begin{bmatrix}\begin{array}{c}
\bar{h}^{n+1}\\
h^{n+1}\;\bar{\mathbf{u}}^{n+1}\left({\displaystyle \frac{2\left(h^{n+1}\right)^{2/3}}{\left(h^{n+1}\right)^{2/3}+\sqrt{\left(h^{n+1}\right)^{4/3}+2\Delta t^{n}\ g\ n^{2}\ \left\Vert \mathbf{\bar{u}}^{n+1}\right\Vert }}}\right)
\end{array}\end{bmatrix}\label{eq:fric-exact}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
We note that (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fric-classic"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fric-marche"

\end_inset

) can be obtained by Taylor series at first order of this exact solution
 of the full implicit problem.
 These three expressions (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fric-classic"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fric-marche"

\end_inset

,
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:fric-exact"

\end_inset

) give the property 
\begin_inset Formula $q^{n}q^{n+1}\geq0$
\end_inset

 and no limitating value is needed like it is done by Burguete and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Burguete2008"
literal "true"

\end_inset

 to stabilize the method at wet-dry front.
 Now, in order to obtain a global second order solver as to stabilize in
 time the spatial second order well-balanced method, a time stepping strategy
 is needed.
 A first version can be obtained simply replacing the explicit splitted
 step for 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 in the classical second order SSP-RK2 method, see e.g.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Gottlieb2001"
literal "true"

\end_inset

, by one of the three semi-implicit schemes presented above,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\mathbf{U}_{K}^{(1)}=\mathbf{U}_{K}^{n}+\Delta t^{n}\mathbf{L}(\mathbf{U}_{K}^{n})\\
\mathbf{U}_{K}^{(2)}=\mathbf{U}_{K}^{(1)}+\Delta t^{n}\mathbf{S}_{f}(\mathbf{U}_{K}^{(1)},\mathbf{U}_{K}^{(2)})\\
\mathbf{U}_{K}^{(3)}=\mathbf{U}_{K}^{(2)}+\Delta t^{n}\mathbf{L}(\mathbf{U}_{K}^{(2)})\\
\mathbf{U}_{K}^{(4)}=\mathbf{U}_{K}^{(3)}+\Delta t^{n}\mathbf{S}_{f}(\mathbf{U}_{K}^{(3)},\mathbf{U}_{K}^{(4)})\\
\mathbf{U}_{K}^{n+1}={\displaystyle \frac{1}{2}}\left(\mathbf{U}_{K}^{n}+\mathbf{U}_{K}^{(4)}\right)
\end{array}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If this time splitting strategy is stable and preserve positivity, it is
 only first order accurate.
 In order to derive a second order time splitting with an full implicit
 discretization of the source term, Pareschi and Russo in 
\begin_inset CommandInset citation
LatexCommand cite
key "Pareschi2005"
literal "true"

\end_inset

 derive an implicit-explicit (IMEX) Runge-Kutta method for hyperbolic conservati
on laws with stiff relaxation terms.
 The original scheme named IMEX-SSP(3,2,2) have been choosen and transformated
 for numerical implementation purpose writes as follow,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{lcll}
\mathbf{U}_{K}^{(1)} & = & \mathbf{U}_{K}^{n} & +{\displaystyle \frac{\Delta t^{n}}{2}}\mathbf{S}_{f}(\mathbf{U}_{K}^{(1)})\\
\mathbf{U}_{K}^{(2)} & = & 2\mathbf{U}_{K}^{n}-\mathbf{U}_{K}^{(1)} & +{\displaystyle \frac{\Delta t^{n}}{2}}\mathbf{S}_{f}(\mathbf{U}_{K}^{(2)})\\
\mathbf{U}_{K}^{(3)} & = & \mathbf{U}_{K}^{n} & +\Delta t^{n}\mathbf{L}(\mathbf{U}_{K}^{(2)})\\
\mathbf{U}_{K}^{(4)} & = & \mathbf{U}_{K}^{(1)}+\mathbf{U}_{K}^{(2)}+\mathbf{U}_{K}^{(3)}-2\mathbf{U}_{K}^{n} & +{\displaystyle \frac{\Delta t^{n}}{2}}\mathbf{S}_{f}(\mathbf{U}_{K}^{(4)})\\
\mathbf{U}_{K}^{(5)} & = & \mathbf{U}_{K}^{n} & +\Delta t^{n}\mathbf{L}(\mathbf{U}_{K}^{(4)})\\
\mathbf{U}_{K}^{n+1} & = & {\displaystyle \frac{1}{2}}\left(\mathbf{U}_{K}^{(5)}-\mathbf{U}_{K}^{(3)}\right)+\mathbf{U}_{K}^{(4)}
\end{array}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The three stages implicit part of this time splitting is a DIRK scheme 
\begin_inset CommandInset citation
LatexCommand cite
key "Pareschi2005"
literal "true"

\end_inset

 respecting A-stability, L-stability and is stiffly accurate (
\begin_inset Formula $R(\infty)=0$
\end_inset

) like it is demonstrated in 
\begin_inset CommandInset citation
LatexCommand cite
key "Hairer2004"
literal "true"

\end_inset

.
 Such stability properties allow to deal with wet/dry front where the friction
 source term 
\begin_inset Formula $\mathbf{S}_{f}$
\end_inset

 can 
\begin_inset Quotes eld
\end_inset

as stiff as possible
\begin_inset Quotes erd
\end_inset

 since the water depth is vanishing.
 The explicit part is the same SSP-RK2 scheme presented above.
 This version of the DIRK scheme has been found important to treat non trivial
 boundaries conditions without any special correction.
\end_layout

\begin_layout Subsection
Boundary conditions
\end_layout

\begin_layout Standard
Main classic idea to manage the boundary conditions is to define ghost conservat
ive vectors, 
\begin_inset Formula $\mathbf{U}_{K_{e}}^{G}$
\end_inset

 for the first order scheme and 
\begin_inset Formula $\mathbf{U}_{e,K_{e}}^{G}$
\end_inset

 for the second order one, that are directly used in the well-balanced scheme
 (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:semi-discrete-wb"

\end_inset

) when the edge 
\begin_inset Formula $e$
\end_inset

 is at the boundary of the computational domain 
\begin_inset Formula $\Omega$
\end_inset

 (the well-balanced schemes have a consequence that is not easy to directly
 impose the numerical flux).
 The notation 
\begin_inset Formula $\mathbf{U}_{K_{e}}^{G}$
\end_inset

 denotes a piecewise constant approximation of 
\begin_inset Formula $\mathbf{U}$
\end_inset

 in a virtual cell 
\begin_inset Formula $K_{e}$
\end_inset

 that is not in the computational domain but exactly used as other ones
 in the first order scheme.
 To simulate the presence of a wall, these primitive variables ghost values
 are specified,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{cccc}
h_{K_{e}}^{G} & = &  & h_{K}\\
\hat{u}_{K_{e}}^{G} & = & - & \hat{u_{K}}\\
\hat{v}_{K_{e}}^{G} & = &  & \hat{v}_{K}
\end{array}\right.\label{eq:bc_wall}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Now, if we want to impose a discharge 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $Q_{\text{in}}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 to a part 
\begin_inset Formula $\Gamma_{\text{in}}$
\end_inset

 of the computational domain boundary 
\begin_inset Formula $\partial K$
\end_inset

, one way to achieve this goal is to specify these primitive variables ghost
 values,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{ccc}
h_{K_{e}}^{G} & = & h_{K}\\
\hat{u}_{K_{e}}^{G} & = & {\displaystyle \frac{Q_{\text{in}}h_{K}^{{\displaystyle \nicefrac{2}{3}}}}{\underset{e\in\Gamma_{\text{in}}}{\sum}m_{e}h_{K}^{{\displaystyle \nicefrac{5}{3}}}}}\\
\hat{v}_{K_{e}}^{G} & = & \hat{v}_{K}
\end{array}\right.\label{eq:bc_in}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
One can easily verify that 
\begin_inset Formula $\underset{e\in\Gamma_{\text{in}}}{\sum}m_{e}\hat{q}_{K_{e}}^{G}=Q_{\text{in}}$
\end_inset

 and 
\begin_inset Formula $\hat{q}_{K_{e}}^{G}=c\:h_{K}^{{\displaystyle \nicefrac{5}{3}}}$
\end_inset

.
 This last condition corresponds to the equilibrium between the gravitationnal
 and friction source terms.
 This boundary condition can be viewed as an approximation of the backwater
 curve since a Neumann boundary condition is applied for the water depth.
 Nevertheless, when the considered wet surface corresponding to 
\begin_inset Formula $\Gamma_{\text{in}}$
\end_inset

 is non trivial, practice show that one can observe the wrong imposed discharge
 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $Q_{\text{in}}$
\end_inset

 (as it will be show later).
 In order to overcome this drawback, a solution is to apply a feedback process
 on the associated ghost bathymetry,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
z_{b}^{\text{new}}\ =\ z_{b}^{\text{old}}+c\left(\mathbf{F}_{e}^{h}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K})-\hat{q}_{K_{e}}^{G}\right)\label{eq:bc_in_correc}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
This process correct the ghost bathymetry 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $z_{b}^{G}$
\end_inset

 at each time step to finally converge to a value implying that the mass
 flux 
\begin_inset Formula $\mathbf{F}_{e}^{h}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K})$
\end_inset

 is stricly equal to the imposed lineic discharge 
\begin_inset Formula $\hat{q}_{K_{e}}^{G}$
\end_inset

.
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
In order to control the water flow at 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
a part 
\begin_inset Formula $\Gamma_{out}$
\end_inset

 of the computational domain boundary 
\begin_inset Formula $\partial K$
\end_inset

 , a water depth or a rating curve 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $Q_{out}(h)$
\end_inset

 is imposed such that,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{ccc}
h_{K_{e}}^{G} & = & h_{\text{user}}\ \text{or}\ f_{\text{user}}(Q_{out})\\
\hat{u}_{K_{e}}^{G} & = & \hat{u}_{K}+2\left(\sqrt{g\left(h_{K}-h_{K}^{G}\right)}\right)\\
\hat{v}_{K_{e}}^{G} & = & \hat{v}_{K}
\end{array}\right.\label{eq:bc_out}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Imposing the water depth in the ghost cell directly or linearly interpoled
 from a tabulated rating curve 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\eta(Q_{out})$
\end_inset

 with 
\begin_inset Formula $Q_{out}={\displaystyle \sum_{e\in\Gamma_{out}}m_{e}\ \mathbf{F}_{e}^{h}(\mathbf{U}_{K}^{n},\mathbf{U}_{K_{e}}^{n},\mathbf{n}_{e,K})}$
\end_inset

 to be consistant with the manner to impose the discharge 
\begin_inset Formula $Q_{\text{in}}$
\end_inset

 (at the condition to relax the relation 
\begin_inset Formula $\eta(Q_{out})$
\end_inset

 in time).
\end_layout

\begin_layout Standard
In the case of the second-order scheme that needs to reconstruct the conservativ
e variable vector 
\begin_inset Formula $\mathbf{U}_{e,K_{e}}^{G}$
\end_inset

 at ghost side of edge 
\begin_inset Formula $e$
\end_inset

, 
\begin_inset Formula $\mathbf{U}_{K_{e}}^{G}$
\end_inset

 is first used in the least square method (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ls_muscl"

\end_inset

) to calculate the vectorial slope in the interior cell 
\begin_inset Formula $K$
\end_inset

.
 The conditions (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:bc_wall"

\end_inset

), (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:bc_in"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:bc_out"

\end_inset

) are then used a second time replacing 
\begin_inset Formula $\mathbf{U}_{K}$
\end_inset

 by 
\begin_inset Formula $\mathbf{U}_{e,K}$
\end_inset

 to obtain 
\begin_inset Formula $\mathbf{U}_{e,K_{e}}^{G}$
\end_inset

.
 Finally, The hydrostatic reconstructed water depth 
\begin_inset Formula $\mathbf{U}_{K}^{G^{*}}$
\end_inset

 and 
\begin_inset Formula $\mathbf{U}_{e,K}^{G^{*}}$
\end_inset

 are calculated in the same way through equations (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hydrostatic_h_1"

\end_inset

) and (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hydrostatic_h_2"

\end_inset

) with 
\begin_inset Formula $z_{e,K_{e}}^{G}=z_{e,K_{e}}$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Validation
\end_layout

\begin_layout Standard
This section is dedicated to the validation of the numerical schemes implemented
 in the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
DassFlow{}
\end_layout

\end_inset

 software presenting several challenging and relevant test cases in context
 of hydraulic and environnemental studies : dam break, channel and run-up
 problems with dynamic wet/dry fronts and considering non-linear friction.
 We will show the formally global second-order convergence in space and
 time of our shallow water numerical model with the Manning-Strickler friction
 source term as the robust treatment of wet/dry fronts.
\end_layout

\begin_layout Standard
In order to quantify the numerical errors, we define these relative error
 norms,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
e_{p}(x)={\displaystyle {\displaystyle \frac{\Vert x^{\text{num}}-x^{\text{exact}}\Vert_{p}}{\Vert x^{\text{exact}}\Vert_{p}}\quad}},\quad e_{p}^{T}(x)={\displaystyle \frac{1}{T}\int_{0}^{T}e_{p}(x)\ dt}\\
\\
\Vert x\Vert_{p}=\left({\displaystyle \sum_{K\in\Omega}m_{K}\left|x_{K}\right|^{p}}\right)^{1/p}
\end{array}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $x^{\text{num}}$
\end_inset

 is the numerical solution with 
\begin_inset Formula $n$
\end_inset

 cells of discretization and 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $x^{\text{exact}}$
\end_inset

 is the analytical solution of the test case or the converge reference solution
 when the analytical solution is not known (
\begin_inset Formula $x_{i}^{\text{exact}}$
\end_inset

 is properly numerically integrated with desired accuracy in sense of used
 Finite Volume schemes).
\end_layout

\begin_layout Subsection
Water at rest
\end_layout

\begin_layout Standard
We consider in a box 
\begin_inset Formula $1000$
\end_inset

 meter long a zero bed elevation, ramdomly perturbated cell by cell with
 a maximum amplitude of 
\begin_inset Formula $1\ m$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
z_{b}=r\quad\text{with}\quad r\in\left[-1,1\right]
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If the simualtion is initialized with a water elevation of zero, i.e.
 
\begin_inset Formula $z_{b}+h=0$
\end_inset

, the resulting 
\begin_inset Quotes eld
\end_inset

lake
\begin_inset Quotes erd
\end_inset

 should stay at rest.
 After a simulation time of 
\begin_inset Formula $3600\ s$
\end_inset

, the results with different schemes are showed in the Fig.
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:water-at-rest"

\end_inset

.
 The norms of the final velocities are given in the Tab.
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Water-at-rest"

\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="7">
<features booktabs="true" tabularvalignment="middle">
<column alignment="center" valignment="top" width="5text%">
<column alignment="center" valignment="top" width="10text%">
<column alignment="center" valignment="top" width="10text%">
<column alignment="center" valignment="top" width="10text%">
<column alignment="center" valignment="top" width="10text%">
<column alignment="center" valignment="top" width="10text%">
<column alignment="center" valignment="top" width="10text%">
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1°order
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1°order / WB-A
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2°order
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2°order / MP limiter / WB-A / CFL 0.5 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2°order/ MP limiter / WB-A / CFL 0.25 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2°order/ Barth limiter / WB-A
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Vert\mathbf{u}\Vert_{\infty}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2.30$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.04\ 10^{-13}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2.23$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.45\ 10^{-2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $9.66\ 10^{-14}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $7.66\ 10^{-14}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\Vert\mathbf{u}\Vert_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.14$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $6.92\ 10^{-16}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0.95$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.95\ 10^{-5}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $9.40\ 10^{-16}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $6.97\ 10^{-16}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Water at rest test case, absolute infinity and 
\begin_inset Formula $L_{1}$
\end_inset

 norms of the final velocities.
\begin_inset CommandInset label
LatexCommand label
name "tab:Water-at-rest"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/water_at_rest_first.pdf
	lyxscale 60
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/water_at_rest_first_b1.pdf
	lyxscale 60
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/water_at_rest_muscl_b1_cfl_0.5.pdf
	lyxscale 60
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/water_at_rest_muscl_b1_b.pdf
	lyxscale 60
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Water at rest test case, final water depth and velocities; (up-left) first
 order scheme; (up-right) well-balanced first order scheme; (down-left)
 well-balanced second order scheme with the MP limiter and a CFL number
 of 
\begin_inset Formula $0.5$
\end_inset

; (down-right) well-balanced second order scheme with the Barth limiter.
\begin_inset CommandInset label
LatexCommand label
name "fig:water-at-rest"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Parabolic bowl with linear friction
\end_layout

\begin_layout Standard
Analytical solutions of the nonlinear shallow water equations considering
 a linear friction and a parabolic bottom topography were derived by Sampson
 
\begin_inset CommandInset citation
LatexCommand cite
key "Sampson2006"
literal "true"

\end_inset

, following the work of Thacker 
\begin_inset CommandInset citation
LatexCommand cite
key "Thacker1981"
literal "true"

\end_inset

, by considering a linear friction in replacement of Coriolis force.
 These solutions involve a flat surface oscillating motion with wet/dry
 fronts, decaying over time because of friction.
 It gives a very popular test for a shallow water numerical solver 
\begin_inset CommandInset citation
LatexCommand cite
key "Audusse2005,Liang2009,Song2011,Kesserwani2012,Hou2013"
literal "true"

\end_inset

.
 The solution is,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{ccl}
\eta(x,t) & = & h_{0}+{\displaystyle \frac{a^{^{2}}B^{^{2}}e^{-\tau t}}{8g^{^{2}}h_{0}}\left({\displaystyle -s\tau}\sin2st+\left({\displaystyle \frac{\tau^{2}}{4}-s^{^{2}}}\right)\cos2st\right)}\\
 &  & -{\displaystyle \frac{B^{2}e^{-\tau t}}{4g}-{\displaystyle \frac{e^{-\tau t/2}}{g}}\left(Bs\cos st+{\displaystyle \frac{\tau B}{2}\sin st}\right)x}\\
\\
u(x,t) & = & Be^{-\tau t/2}\sin st
\end{array}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $p=\sqrt{{\displaystyle 8gh_{0}}}/a$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 and 
\begin_inset Formula $s={\displaystyle \sqrt{p^{2}-\tau^{2}}/2}$
\end_inset

 (and then valid if 
\begin_inset Formula $p>\tau$
\end_inset

).
 We choose two set of parameters,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\text{set 1}\ \ \left\{ \begin{array}{ccc}
h_{0} & = & 10\ m\\
a & = & 3000\ m\\
B & = & 5\ m.s^{-1}\\
\tau & = & 0.001\ s^{-1}
\end{array}\qquad\right.\text{set 2}\ \ \left\{ \begin{array}{ccc}
h_{0} & = & 1\ m\\
a & = & 30\ m\\
B & = & 1\ m.s^{-1}\\
\tau & = & 0.2\ s^{-1}
\end{array}\right.\label{eq:set-bowl}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The first one corresponding to the classic parameters chosen into litterature
 as in 
\begin_inset CommandInset citation
LatexCommand cite
key "Liang2009,Kesserwani2012"
literal "true"

\end_inset

.
 The Fig.(
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:bowl_norms"

\end_inset

) shows the calculated relative error norms 
\begin_inset Formula $e_{1}^{T}(h)$
\end_inset

 with this first set of parameters using the MP limiter for the second order
 well-balanced scheme.
 One can observe the correct convergence behavior of all well-balance schemes
 and demonstrate that the moving wet-dry fronts are robustly captured (a
 cut-off water depth 
\begin_inset Formula $h_{\epsilon}\in\left[10^{-4},10^{-8}\right]$
\end_inset

 have been used for these simulations in order to find a linear convergence
 behavior in log-log scale).
 A rate of convergence of approximatively 1.5 is found for the second-order
 well-balance scheme with the hybrid SSP-RK2 time splitting as with the
 IMEX time splitting (It is found a relative error norm 
\begin_inset Formula $e_{1}^{T}(h)\simeq2.10^{-3}$
\end_inset

 for 
\begin_inset Formula $n=100$
\end_inset

 which is approximatively the same in 
\begin_inset CommandInset citation
LatexCommand cite
key "Liang2009"
literal "true"

\end_inset

).
 This loss of second order accuracy is most probably due to the presence
 of the two moving wet/dry fronts introducing singularities in the solution.
 But a most interesting observation is that there is no major difference
 between the two time splitting strategy despite the fact that the hybrid
 RK2 is first order accurate and the IMEX second order accurate, except
 maybe for very fine meshes.
 This demonstrates that the spatial consistency error is greater than the
 time one despite the accuracy slopes difference.
 If simulations are performed now with the second set of paramaters (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:set-bowl"

\end_inset

), then it is obtained a significant difference between the two time splitting
 methods Fig.(
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:bowl_norms"

\end_inset

).
 After an asymptotic first order behavior for coarse meshes, the hybrid
 RK2 time splitting gives a rate of convergence of 1 and the IMEX time splitting
 maintains the same 1.5 rate of convergence obtained with the first classic
 set of parameters (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:set-bowl"

\end_inset

).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/thacker_conv.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/thacker_conv_splitting_error.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
(left) Rate of convergence for the norm 
\begin_inset Formula $e_{1}^{T}(h)$
\end_inset

 with set 1 of physical parameters, 
\begin_inset Formula $n$
\end_inset

 is the cells number (right) Same with set 2.
\begin_inset CommandInset label
LatexCommand label
name "fig:bowl_norms"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align left
Nevertheless, the friction source term is linear for these simulations and
 it do not corresponds to our original model where the Manning-Strickler
 friction source term is non-linear.
 The singularities at the moving wet/dry fronts cannot guarantee to measure
 precisely the right accuracy of the numerical methods of regular solutions.
 In conclusion, this test case is interesting to check robustness to deal
 with wet/dry fronts, but largely insufficient to be relevant to test the
 behavior of our numerical solver in context of hydraulic and environnemental
 studies.
\end_layout

\begin_layout Subsection
Dam break(s) with slope and non-linear friction
\end_layout

\begin_layout Standard
Numerical model behavior is investigated for dam break problems with a non
 zero slope and with the non-linear Manning-Strickler friction source term
 vanishing with the water depth at wet/dry front.
\end_layout

\begin_layout Subsubsection
\begin_inset Quotes eld
\end_inset

Failling Gaussian
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Standard
A 
\begin_inset Quotes eld
\end_inset

regularised
\begin_inset Quotes erd
\end_inset

 dam break problem is first performed in sense that all eventual singularities
 in numerical solution are eliminated by construction.
 Considering the following initial condition,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{rclccc}
z_{b}(x) & = &  &  & 0.5\  & e^{-{\displaystyle \frac{\left(x-l_{x}/2\right)^{2}}{2\ \sigma^{2}}}}\\
h(x,t=0) & = & 0.1 & + & 0.5\  & e^{-{\displaystyle \frac{\left(x-l_{x}/2\right)^{2}}{2\ \sigma^{2}}}}
\end{array}\right.
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\begin_inset Formula $\sigma=100\ m$
\end_inset

, a computational domain lenght 
\begin_inset Formula $l_{x}=1000\ m$
\end_inset

, a Manning-Strickler roughness coefficient 
\begin_inset Formula $n=0.05$
\end_inset

 and a gravitational acceleration 
\begin_inset Formula $g=10\ m.s^{-1}$
\end_inset

, a converge simulation is performed with a 12800 cells mesh at time 
\begin_inset Formula $t=100\ s$
\end_inset

.
 Initial condition and converge result are plotted in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:falling_gaussian"

\end_inset

.
 One can note that these parameters are suitable in context of hydraulic.
 The topography gradient is chosen not constant in order to avoid an exact
 calculation of the topography gradient.
 The rates of convergence for the norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 and 
\begin_inset Formula $e_{1}(q)$
\end_inset

 showed on Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:falling_gaussian"

\end_inset

 give a very clear accuracy result.
 As the hybrid RK2 time stepping method is only first order accurate, the
 same overall first order convergence rate is found than for the spatial
 first order well-balanced scheme.
 The relative error norms are still smaller in significant proportion due
 to the enhanced spatial accuracy at second order.
 Concerning the IMEX time stepping method, a second-order rate of convergence
 is found.
 As a consequence, the relative error norms become very small even for very
 coarse meshes.
 This demonstrates the global second-order convergence rate of presented
 numerical model with MUSCL linear reconstruction with appropriate limitation
 and IMEX time stepping.
 Nevertheless, one may be careful that this rate of convergence will be
 smaller with singularities in numerical solution as with non trivial boundary
 conditions.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/falling_gaussian_conv.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/falling_gaussian_xy.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
(left) Rates of convergence for the norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 and 
\begin_inset Formula $e_{1}(q)$
\end_inset

, 
\begin_inset Formula $n$
\end_inset

 is the cells number (right) Half-domain initial condition, converge simulation
 with 12800 cells and relative simulations with 25 cells.
\begin_inset CommandInset label
LatexCommand label
name "fig:falling_gaussian"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Flat slope and wet/dry front
\end_layout

\begin_layout Standard
The idealized dam break problem involving a dynamic wet/dry front is now
 investigated.
 The non-linear Manning-Strickler friction is taken into account and a non
 zero flat slope is considered as it is sketched in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:dambreak-sketch"

\end_inset

.
 The parameters used are a computational domain length 
\begin_inset Formula $l_{x}=1000\ m$
\end_inset

 with wall boundaries at each side, a slope 
\begin_inset Formula $s=0.5\ \%$
\end_inset

, a Manning-Strickler roughness coefficient 
\begin_inset Formula $n=0.05$
\end_inset

 and a gravitational acceleration 
\begin_inset Formula $g=10\ m.s^{-1}$
\end_inset

.
 The water column has a length 
\begin_inset Formula $L=50\ m$
\end_inset

 and two height are considered, 
\begin_inset Formula $H=1\ \text{or}\ 5\ m$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/dambreak.svg
	lyxscale 50
	width 40text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
dam-break problem sketch.
\begin_inset CommandInset label
LatexCommand label
name "fig:dambreak-sketch"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
As no analytical solution can be derived, two converge simulations are again
 performed with 12800 cells for 
\begin_inset Formula $H=5\ m$
\end_inset

 at time 
\begin_inset Formula $t=500\ s$
\end_inset

 and for 
\begin_inset Formula $H=1\ m$
\end_inset

 at time 
\begin_inset Formula $t=2000\ s$
\end_inset

.
 After the initial simulation time, a rarefaction wave goes upstream and
 interacts with the left wall boundary while a shock wave goes downstream,
 both modifing the initial water column shape.
 After a sufficient simulation time, the water column completly disappears
 and the new water shape exhibits more mass and stronger gradients downstream.
 The dynamic wet/dry front is robustly captured by well-balanced first-
 and second-order schemes without any cut-off water depth 
\begin_inset Formula $h_{\epsilon}$
\end_inset

 , despite that the well-balanced property is needless for this problem.
 We have verify that the schemes are stricly positive and do not generate
 any negative water depth.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/dam_h_5_conv.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/dam_h_5.pdf
	lyxscale 50
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Caption Standard

\begin_layout Plain Layout
Idealized dam break problem with 
\begin_inset Formula $H=5\ m$
\end_inset

.
 (left) rates of convergence for the norm 
\begin_inset Formula $e_{1}(h)$
\end_inset

 for different schemes; (right) corresponding initial condition, converge
 simulation with 12800 cells and results with 100 cells.
\begin_inset CommandInset label
LatexCommand label
name "fig:dam-break_h_5"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/dam_h_1_conv.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/dam_h_1.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Idealized dam break problem with 
\begin_inset Formula $H=1\ m$
\end_inset

.
 (left) rates of convergence for the norm 
\begin_inset Formula $e_{1}(h)$
\end_inset

 for different schemes; (right) corresponding initial condition, converge
 simulation with 12800 cells and results with 100 cells.
\begin_inset CommandInset label
LatexCommand label
name "fig:dam-break_h_1"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Observing the relative error norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:dam-break_h_5"

\end_inset

 and Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:dam-break_h_1"

\end_inset

, on can first note that the previous obtained second-order convergence
 rate is loosed due to the singularities in the numerical solution and especiall
y at wet/dry front.
 Nevertheless, the relative error norm 
\begin_inset Formula $e_{1}(h)$
\end_inset

 is smaller for a given grid size using the IMEX time stepping rather than
 the hybrid RK2 one and even more comparatively to the first order schemes.
 If there is no major difference between the schemes with or without the
 well-balanced property when initially 
\begin_inset Formula $H=5\ m$
\end_inset

, this difference is obvious when 
\begin_inset Formula $H=1\ m$
\end_inset

.
 The well-balanced second-order scheme with the hybrid RK2 time stepping
 gives a result very similar to the first order scheme without the well-balanced
 property.
 This indicates a drawback in both well-balanced methods when the water
 depth is close to the bathymetry difference.
 Sufficiently important to give very wrong numerical solutions with first
 order schemes.
 In conclusion, in order to use these methods to simulate hydraulic flows,
 one may be careful to verify this criteria to produce meshes.
\end_layout

\begin_layout Subsection
simple channel
\end_layout

\begin_layout Standard
In order to perform river flood simulations with real topography, it is
 interesting now to check the numerical model behavior to simulate an open-chann
el flow with a non constant topography gradient.
\end_layout

\begin_layout Subsubsection
Mac Donald's benchmark
\end_layout

\begin_layout Standard
As it would be too restrictive to consider a channel with a constant topography
 gradient, the Mac Donald's analytic steady solution for open-channel flow
 is prefered 
\begin_inset CommandInset citation
LatexCommand cite
key "MacDonald1997"
literal "true"

\end_inset

.
 Making the hypothesis of a contant discharge in space, it can be easily
 verify that the steady states verify,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
\partial_{t}h=\partial_{t}q=\partial_{x}q=0\\
\\
\partial_{x}z_{b}=\left({\displaystyle \frac{q^{2}}{gh^{3}}-1}\right)\partial_{x}h-{\displaystyle \frac{n^{2}q^{2}}{h^{10/3}}}
\end{array}\label{eq:open-channel-sol}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
that gives analytical steady solutions with a non necessary constant topography
 gradient.
 We consider like in 
\begin_inset CommandInset citation
LatexCommand cite
key "Delestre2012"
literal "true"

\end_inset

 a computational domain lenght 
\begin_inset Formula $l_{x}=1000\ m$
\end_inset

, a lineic discharge 
\begin_inset Formula $q=2\ m^{2}/s$
\end_inset

 and a Manning-Strickler roughness coefficient 
\begin_inset Formula $n=0.033$
\end_inset

.
 Considering this exact water depth,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
h^{\text{exact}}(x)=\left({\displaystyle \frac{4}{g}}\right)^{1/3}\left(1+{\displaystyle \frac{1}{2}\exp\left(-16\left({\displaystyle \frac{x}{1000}-\frac{1}{2}}\right)^{2}\right)}\right)\label{eq:mcdonald_exact_h}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
insuring that the flow is subcritical in all the channel, the bottom topography
 is numerically integrated with appropriate accurary that gives the xyplot
 Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mcdonald_sol"

\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_exact.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Open-channel steady state solution (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:open-channel-sol"

\end_inset

) considering the exact water depth (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mcdonald_exact_h"

\end_inset

).
 
\begin_inset CommandInset label
LatexCommand label
name "fig:mcdonald_sol"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The discharge is imposed upstream of the flow and the exact water depth
 is prescribed downstream.
 Initialising the simulations with dry cells except at the first cell at
 inflow, the steady states are properly achieved in time.
 The relative error norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 and 
\begin_inset Formula $e_{1}(q)$
\end_inset

 showed in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mcdonald_res"

\end_inset

 give the same result than for the previous 
\begin_inset Quotes eld
\end_inset

regularised
\begin_inset Quotes erd
\end_inset

 dam break problem.
 The well-balanced second order scheme with the hybrid RK2 time stepping
 is only first order accurate with a smaller error than for the first order
 whereas with the IMEX time stepping the numerical model is formally at
 second order with very small errors even for very coarse meshes.
 A surprising result is that this rate of convergence is obtained with non
 trivial inflow/outflow boundary conditions even if this benchmark problem
 is only onedimensional.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/channel_conv.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/channel_xy.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Open-channel benchmark results : (left) relative error norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 and 
\begin_inset Formula $e_{1}(q)$
\end_inset

, 
\begin_inset Formula $n$
\end_inset

 is the cells number; (right) exact solutions for 
\begin_inset Formula $h$
\end_inset

 and 
\begin_inset Formula $u$
\end_inset

 and simulations with 25 cells.
\begin_inset CommandInset label
LatexCommand label
name "fig:mcdonald_res"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
perturbed topography
\end_layout

\begin_layout Standard
The topography is not so smooth in real-life than in the previous test case
 where a channel 
\begin_inset Formula $1000\ m$
\end_inset

 long was considered.
 It is tested here the numerical model introducing gradually in frequency
 some perturbations to an initial channel 
\begin_inset Formula $10000\ m$
\end_inset

 long with a constant slope of 
\begin_inset Formula $0,25\ \%$
\end_inset

 such that,\SpecialChar ligaturebreak

\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{array}{c}
{\displaystyle z_{b}=z_{b}+\sum_{i=1}^{n_{p}}0.25\sin\left({\displaystyle 2\pi\left({\displaystyle \frac{p_{i}\ x}{l_{x}}}+r_{i}\right)}\right)}\quad\text{with}\quad r_{i}\in\left[0,1\right]\end{array}\label{eq:channel_perturb}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\begin_inset Formula $n_{p}=1,2,3,4,5\ \text{and}\ 6$
\end_inset

 and 
\begin_inset Formula $p_{i}=7,24,57,108,205\ \text{and}\ 402$
\end_inset

.
 In order to control the flow at inflow and outflow, and especially the
 backwater curve at the inflow, the topography gradient is kept constant
 close to taking care to maintain perburtations spatially continuous.
 The other parameters are a Manning-Strickler roughness coefficient 
\begin_inset Formula $n=0.05$
\end_inset

, a lineic discharge 
\begin_inset Formula $q=1\ m^{2}/s$
\end_inset

 and a gravitational acceleration 
\begin_inset Formula $g=10\ m.s^{-1}$
\end_inset

.
 Since the exact solution for the initial constant slope channel is 
\begin_inset Formula $h=1\ m$
\end_inset

 (and 
\begin_inset Formula $u=1\ m/s$
\end_inset

), the topography perturbations are of the same order of magnitude.
 The opposite case would be obviously irrelevant.
 Main goal is to find a criteria that insures a good accuracy to apply the
 numerical model with real topography.
 Simulations are performed with the well-balanced second-order scheme and
 the IMEX time stepping until the steady state is properly found.
 For each of these six cases, a converge simulation is performed with 12800
 cells of discretization showed at the left of the Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:channel_perturb_res"

\end_inset

.
 One can note that the flow respects the shallow water model hypothesis
 since the smaller wavelength has a value of 
\begin_inset Formula $25\ h$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/perturb_bathy_channel_exact.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/perturb_bathy_channel_conv.pdf
	lyxscale 40
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Channel 
\begin_inset Formula $10000\ m$
\end_inset

 long with a constant slope of 
\begin_inset Formula $0,25\ \%$
\end_inset

 introducing gradually in frequency some perturbations in topography according
 to (
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:channel_perturb"

\end_inset

) : (left) six cases with channel bottom topography and associated converge
 simulations; (right) associated relative error norm 
\begin_inset Formula $e_{1}(h)$
\end_inset

 with 
\begin_inset Formula $n$
\end_inset

 cells of discretization (the greyer zone corresponds to less than 4 cells
 of discretization for the highest frequency for each case).
\begin_inset CommandInset label
LatexCommand label
name "fig:channel_perturb_res"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The calculation of the relative error norms 
\begin_inset Formula $e_{1}(h)$
\end_inset

 evolving the mesh step size 
\begin_inset Formula $n$
\end_inset

 shows in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:channel_perturb_res"

\end_inset

 that introducing gradually in frequency some perturbations in the topography
 damages the simulations accuracy.
 This phenomenom is in a first time likely proportional to the highest perturbat
ion frequency before saturing when the mesh is too coarse comparatively
 to the highest frequency introduced.
 The criteria to maintain a good accuracy as the right correct second-order
 convergence rate is to discretize the channel topography with a minimum
 of four points for the highest perturbation frequency.
\end_layout

\begin_layout Subsection
Solitiary wave on a simple beach
\end_layout

\begin_layout Standard
It is well know that the shallow water equations can be a suitable model
 to study numerically storm surges as the complete life-cycle of a tsunami
 (generation, propagation and run-up on the coast).
 The classic benchmark problem was introduced by Synolakis and al.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Synolakis1987"
literal "true"

\end_inset

 deriving an adimensionnal analytical solution for the run-up of a solitary
 wave on a simple sloping beach.
 Following the parameters retained in the NOAA technical report for evaluation
 of tsunami numerical models 
\begin_inset CommandInset citation
LatexCommand cite
key "Synolakis2007"
literal "true"

\end_inset

, the initial condition with dimensional parameters sketched in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:beach_sketch"

\end_inset

 is,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\eta(x,0)=H\ sech^{^{2}}\left(\gamma\left({\displaystyle \frac{x-x_{0}-L}{d}}\right)\right)\quad\text{and}\quad u(x,0)=-\sqrt{{\displaystyle \frac{g}{d}}}\ \eta(x,0)
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
with 
\begin_inset Formula $\cot\beta=19.85$
\end_inset

, 
\begin_inset Formula $\gamma=\sqrt{3H/4d}$
\end_inset

 and 
\begin_inset Formula $L=\text{arccosh}\left(\sqrt{20}\right)/\gamma$
\end_inset

.
 The wave height satifies the adimendional parameter 
\begin_inset Formula $H/d=0.0185$
\end_inset

.
 The computational domain is 
\begin_inset Formula $100\:d$
\end_inset

 long, the mesh step size respects 
\begin_inset Formula $\Delta x=d/10$
\end_inset

 and wall boundaries conditions are prescribed.
 Using the well-balanced second-order numerical scheme with the MP limter
 and IMEX time stepping, resulting water levels profiles and two time series
 are plotted in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:beach_res"

\end_inset

 as superposed the nonlinear analytical solution.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/plane_beach.svg
	lyxscale 75
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Caption Standard

\begin_layout Plain Layout
Dimensional sketch of the solitiary wave run-up benchmark problem sketch.
\begin_inset CommandInset label
LatexCommand label
name "fig:beach_sketch"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
placement tbh
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figs/beach_t_35_45_55_65.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Graphics
	filename figs/beach_x_0.25_9.95.pdf
	lyxscale 50
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Run-up of a solitiary wave on a simple beach : comparison of analytical
 solution (scatters) versus numerical solution (solid lines).
\begin_inset CommandInset label
LatexCommand label
name "fig:beach_res"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
According to Synolakis and al.
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "Synolakis2007"
literal "true"

\end_inset

 page 5, “
\shape italic
any well benchmarked code should produce results within 5% of the calculated
 value from the analytical solution
\shape default

\begin_inset Quotes erd
\end_inset

 which is the case for our simulation which is spatially everywhere very
 close to the analytical solution.
 There is no particular 
\begin_inset Quotes eld
\end_inset

distortion
\begin_inset Quotes erd
\end_inset

 in the numerical solution at adimensional time 
\begin_inset Formula $t/\tau=45\ \text{and}\ 65$
\end_inset

 in proximity to the wet/dry front whereas other numerical models can produce
 some like it is showed in the NTHMP workshop report 
\begin_inset CommandInset citation
LatexCommand cite
key "2012"
literal "true"

\end_inset

.
 This demonstrates that our well-balanced treatment at wet/dry front do
 not affect a wave run-up computation accuracy.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Cost functions
\begin_inset CommandInset label
LatexCommand label
name "part:CostFunction"

\end_inset


\end_layout

\begin_layout Standard

\series bold
Computation of the cost function
\series default
:
\end_layout

\begin_layout Standard
Computation of the cost function is done by the subroutine
\shape italic
 calc_cost_function(cost,mesh)
\shape default
 of the file
\shape italic
 src/common/m_obs.f90.
\end_layout

\begin_layout Standard
Resutlt 
\shape italic
cost
\shape default
 is the sum of 3 
\shape italic
cost_part 
\shape default
(
\shape italic
cost=cost_part(1)+cost_part(2)+cost_part(3)
\shape default
):
\end_layout

\begin_layout Itemize
cost_part(1): 
\end_layout

\begin_layout Standard
\align left
\begin_inset Formula 
\[
\begin{array}{c}
{\displaystyle \sum_{i=1,\mathrm{Nobs}}\omega_{i}\sum_{j=1,\mathrm{Ntimes}}\left(\bar{h}_{i,j}-\bar{h}_{i,j}^{obs}\right)^{2}+{\displaystyle \sum_{i=1,\mathrm{Nobs}}\omega_{i}\sum_{j=1,\mathrm{Ntimes}}\left(\bar{w}_{i,j}-\bar{w}_{i,j}^{obs}\right)^{2}}}\\
{\displaystyle \sum_{i=1,\mathrm{Nobs}}\omega_{i}\sum_{j=1,\mathrm{Ntimes}}\left(innovation_{i,j}\right)+{\displaystyle \sum_{i=1,\mathrm{Nobs}}\omega_{i}\sum_{j=1,\mathrm{Ntimes}}\left(innovW_{i,j}\right)}}
\end{array}
\]

\end_inset


\end_layout

\begin_layout Itemize
cost_part(2): Bathy regularization
\end_layout

\begin_layout Itemize
cost_part(3): Hydrograph regularisation
\end_layout

\begin_layout Standard

\series bold
Computation of the innovation and innovW vector:
\end_layout

\begin_layout Standard
Computation of the innovation vector is done by the subroutine 
\shape italic
calc_innovation(dof,mesh)
\shape default
 of the file 
\shape italic
src/sw_mono/read_write_obs.f90 
\shape default
and 
\begin_inset Formula $innovation_{i,j}$
\end_inset

 is given by:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
innovation_{i,j}=\bar{h}_{i,j}-\bar{h}_{i,j}^{obs}
\]

\end_inset


\end_layout

\begin_layout Standard
with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{h}_{i,j}$
\end_inset

 compute as :
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\frac{1}{S_{wet}}\int_{S_{wet}}hdx$
\end_inset

,
\family default
\series bold
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula $\frac{1}{S_{obs}}\int_{S_{obs}}hdx$
\end_inset

 
\series default
or 
\series bold

\begin_inset Formula $\frac{1}{S_{river}}\int_{S_{obs}}hdx$
\end_inset

 
\series default
(see code)
\end_layout

\begin_layout Standard
Computation of the innovW vector is done by the subroutine 
\shape italic
calc_innovW( dof,mesh )
\shape default
 of the file 
\shape italic
src/sw_mono/read_write_obs.f90 
\shape default
and 
\begin_inset Formula $innovW_{i,j}$
\end_inset

 is given by: 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
innovW_{i,j}=\bar{w}_{i,j}-\bar{w}_{i,j}^{obs}
\]

\end_inset


\end_layout

\begin_layout Standard
with 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{w}_{i,j}$
\end_inset

 compute as:
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\frac{S_{wet}}{L_{i}}$
\end_inset


\end_layout

\begin_layout Standard

\series bold
Computation of observation (
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{h}_{i,j}^{obs}$
\end_inset


\family default
\series bold
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 and 
\begin_inset Formula $\bar{w}_{i,j}^{obs}$
\end_inset

):
\end_layout

\begin_layout Standard
The computation of 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{h}_{i,j}^{obs}$
\end_inset


\family default
\series bold
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\series default
and
\series bold
 
\begin_inset Formula $\bar{w}_{i,j}^{obs}$
\end_inset


\series default
are done in the subroutine 
\shape italic
sub_write( file_type )
\shape default
 of the file 
\shape italic
src/sw_mono/read_write_obs.f90.
 
\shape default
It is the same computation as 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\bar{h}_{i,j}$
\end_inset

 and 
\begin_inset Formula $\bar{w}_{i,j}$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Python scripts
\end_layout

\begin_layout Itemize

\series bold
createDassFlowObs.py
\series default
: Create a group of cells (stations_with_grp) file from an area (define
 with 4 parameters : 
\begin_inset Formula $x_{min}$
\end_inset

, 
\begin_inset Formula $x_{max}$
\end_inset

, 
\begin_inset Formula $y_{min}$
\end_inset

, 
\begin_inset Formula $y_{max}$
\end_inset

) and a result file.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
nameFile: Name of output file.
 Ex:'station_grp_0001.txt'
\end_layout

\begin_layout Itemize
resultFile: Name of input result file.
 Ex:'./bin/res/result_initial.dat'
\end_layout

\begin_layout Itemize
xlimInf: Lower bound in 
\begin_inset Formula $x$
\end_inset

.
 Ex: 450 
\end_layout

\begin_layout Itemize
xlimSup: Upper bound in 
\begin_inset Formula $x$
\end_inset

.
 Ex: 550
\end_layout

\begin_layout Itemize
ylimInf: Lower bound in 
\begin_inset Formula $y$
\end_inset

.
 Ex: -300 
\end_layout

\begin_layout Itemize
ylimSup: Lower bound in 
\begin_inset Formula $y$
\end_inset

.
 Ex: 300 
\end_layout

\begin_layout Itemize
outputDirectory: Output directory.
 Ex : './bin/'
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
meshToShapefile.py
\series default
: Create from a DassFlow mesh a shapefile file of the mesh ( node and edge)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
meshFile: Name of the input mesh file.
 Ex: './bin/test_case_deb.msh'
\end_layout

\begin_layout Itemize
outputDirectory: Name of the output directory file.
 Ex: './bin/mesh'
\end_layout

\begin_layout Itemize
TraceNode: Boolean if true, nodes are printed, else no.
 Ex: True 
\end_layout

\begin_layout Itemize
TraceEdge: Boolean if true, edges are printed,else no.
 Ex: True
\end_layout

\begin_layout Itemize
EPGScode: EPGS code of the output
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
gmeshMeshToShapefile.py: 
\series default
Same than DassFlowMeshToShapefile.py but with gmesh file.
\end_layout

\begin_layout Itemize

\series bold
resultToShapefile.py: 
\series default
Create shapefile file from DassFlow result.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
resultFile: Name of the result file.
 Ex: './bin/res/result_final.dat' 
\end_layout

\begin_layout Itemize
outputDirectory: Name of the ouput directory.
 Ex: './bin/res/shapefile_1'
\end_layout

\begin_layout Itemize
EPGScode: EPGS code of the output
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
resultToShapefileAll.py: 
\series default
Create shapefile file from all DassFlow result.
\end_layout

\begin_layout Itemize

\series bold
stationObservationToShapefile.py
\series default
: Create shapefile file of observation.
 Each points of the shapefile represent a observations stations or a points
 of a station with group.
\end_layout

\begin_layout Itemize

\series bold
gmeshMeshChangeBathy.py
\series default
: Change the bathy of a gmesh file from a bathy function.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
bathy(x,y): Bathymetry function
\end_layout

\begin_layout Itemize
meshFile: Path of the original Gmesh file.
 Ex: './bin/test_1.msh'
\end_layout

\begin_layout Itemize
meshFileOut: Path of the output Gmesh file with new bathy.
 Ex: './bin/test_2.msh'
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
modifobs.py
\series default
: Change observation file ( in order to add noise for example)
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
numberofobs: Number of observation file.
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
grad.py
\series default
: Plot compute gradiant for hydrograph.
\end_layout

\begin_layout Itemize

\series bold
hydrograph.py
\series default
: Plot result of the minimization (for hydrograph).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
pathOutFile: Path of the output directory.
 Ex: './bin/plotHydrograph/' .
\end_layout

\begin_layout Itemize
pathTargetHydrograph: Path of the target hydrograph.
 Ex: './bin/hydrograph_target.txt'.
\end_layout

\begin_layout Itemize
pathFirstGuess: Path of the first guess hydrograph.
 Ex:'./bin/hydrograph.txt'.
\end_layout

\begin_layout Itemize
legend: Boolean if true plot legend, else no.
 Ex:True.
\end_layout

\begin_layout Itemize
legendTime: Time used ('seconds','hours', 'days').
\end_layout

\begin_layout Itemize
plotMin: Boolean if true plot the result of the minization else no.
\end_layout

\begin_layout Itemize
plotObs: Boolean if true plot time observation for each observation station.
\end_layout

\begin_layout Itemize
plotIntermediaire: Boolean if true plot transitional computation of the
 minimization.
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
manning.py
\series default
: Same than plotHydrograph.py for manning minimzation.
\end_layout

\begin_layout Itemize

\series bold
obsT.py
\series default
: For 
\begin_inset Formula $t$
\end_inset

 fixed, plot the evolution of 
\begin_inset Formula $h^{obs}$
\end_inset

 with 
\begin_inset Formula $x$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
cheminDossierSortie: Path of the ouput directory
\end_layout

\end_deeper
\begin_layout Itemize

\series bold
obsxh.py
\series default
: For each station, plot the evolution of 
\begin_inset Formula $h^{obs}$
\end_inset

 with time 
\begin_inset Formula $t$
\end_inset


\end_layout

\begin_layout Itemize

\series bold
obsxw.py
\series default
: For each station, plot the evolution of 
\begin_inset Formula $w^{obs}$
\end_inset

 with time 
\begin_inset Formula $t$
\end_inset


\end_layout

\begin_layout Itemize

\series bold
obsx.py
\series default
: For each station, plot the evolution of 
\begin_inset Formula $h^{obs}$
\end_inset

 and 
\begin_inset Formula $w^{obs}$
\end_inset

 with time 
\begin_inset Formula $t$
\end_inset


\end_layout

\begin_layout Itemize

\series bold
minCost.py
\series default
 plot 
\begin_inset Formula $J$
\end_inset

 and 
\begin_inset Formula $|\nabla J|$
\end_inset

 vs iterations.
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Annexes
\end_layout

\begin_layout Subsection
Example of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-the-inp"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!	Input File for Shallow-Water Model
\end_layout

\begin_layout Plain Layout

!	(configure your text editor with a 4 tabs space for better reading)
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&list_input
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Mesh Type
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	mesh_type		=	'basic',				! 'basic' , 'dassflow' , 'gmsh'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	mesh_name		=	'mesh_name.geo'			! Mesh File
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Structured mesh parameters (in basic case)
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	lx				=	1000.,					! Domain length in x horizontal direction
\end_layout

\begin_layout Plain Layout

	ly				=	100.,		    		! Domain length in y vertical direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	nx				=	100,					! Number of nodes in x horizontal direction
\end_layout

\begin_layout Plain Layout

	ny				=	10,						! Number of nodes in y vertical direction
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

! Boundary conditions
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	bc_N			=	'wall',					! Type of Boundary condition at Mesh North
\end_layout

\begin_layout Plain Layout

	bc_S			=	'wall',					! Type of Boundary condition at Mesh South
\end_layout

\begin_layout Plain Layout

	bc_W			=	'discharg1',			! Type of Boundary condition at Mesh West
\end_layout

\begin_layout Plain Layout

	bc_E			=	'transm',				! Type of Boundary condition at Mesh East
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Simulation parameters
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	ts				=	14400.,					! Simulation Time
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	dtw				=	14400.,					! Time-Step to output Result Files
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	dtp				=	60.,					! Time-Step to output Post Variables
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	dta				=	60.,					! Data Assimilation Boundary Arrays Time Step
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	verbose			=	0,						! Verbosity Level
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Numerical parameters
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	temp_scheme		=	'euler',		   		! Choice of Temporal Scheme ( euler , rk2
 )
\end_layout

\begin_layout Plain Layout

	spatial_scheme	=	'first_b1',				! Choice of Spatial Scheme ( first , muscl
 )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	adapt_dt		=	1,						! Choice of an Adaptative Time-Step (1) or not (0)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	dt				=	0.05,					! Fixed Simulation Time-Step if adapt_dt = 0
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	cfl				=	0.8,					! CFL number in case of Adaptative Time Step
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	heps			=	0.,						! Cut-off water depth to stabilize SW Numerical Schemes
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	friction		=	1,						! Manning Source Term
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	feedback_inflow	=	1,
\end_layout

\begin_layout Plain Layout

	coef_feedback	=	0.1,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	max_nt_for_direct	=	10000000,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Physical parameters
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	g				=	10.,					! Gravity constant
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Output Results Files Switches
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	w_tecplot		=	1,						! in Tecplot format
\end_layout

\begin_layout Plain Layout

	w_vtk			=	1,						! in VTK format
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	w_exact			=	0,						! Output Exact Solution (if provided in m_user_data.f90)
\end_layout

\begin_layout Plain Layout

	w_norm			=	0,						! Output Linf, L1 and L2 relative error norms
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    w_obs			=	0,						! Writing obs data relating to obs.txt file
\end_layout

\begin_layout Plain Layout

	use_obs			=	0,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Variational Data Assimilation Parameters
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	c_manning		=	0,
\end_layout

\begin_layout Plain Layout

	c_bathy			=	0,
\end_layout

\begin_layout Plain Layout

	c_ic			=	0,
\end_layout

\begin_layout Plain Layout

	c_hydrograph	=	0,
\end_layout

\begin_layout Plain Layout

	c_ratcurve		=	0,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	eps_manning		=	0.1,
\end_layout

\begin_layout Plain Layout

	eps_bathy		=	0.1,
\end_layout

\begin_layout Plain Layout

	eps_ic			=	0.1,
\end_layout

\begin_layout Plain Layout

	eps_hydrograph	=	0.1,
\end_layout

\begin_layout Plain Layout

	eps_ratcurve	=	0.1,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	max_nt_for_adjoint	=	2500,
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	restart_min		=	0,
\end_layout

\begin_layout Plain Layout

	eps_min			=	1.d-4
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The complete 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
inp{}
\end_layout

\end_inset

 file with default values.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-the-usr"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

MODULE m_user_data
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   USE m_common
\end_layout

\begin_layout Plain Layout

   USE m_mesh
\end_layout

\begin_layout Plain Layout

   USE m_sw
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   real(rp), parameter  ::  h0  =  10._rp
\end_layout

\begin_layout Plain Layout

   real(rp), parameter  ::  a   =  3000._rp
\end_layout

\begin_layout Plain Layout

   real(rp), parameter  ::  b   =  5._rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   CONTAINS
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Bed elevation
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION bathy_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      real(rp)  ::  xx
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      xx  =  x  -  demi * lx
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      bathy_user  =  h0 * ( xx / a )**2
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION bathy_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Free surface elevation ( zs = h + bathy )
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION zs0_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs0_user  =  zs_exact( x , y , zero )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION zs0_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Manning coefficient
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION manning_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      manning_user  =  0.001_rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION manning_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Initial x velocity
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION u0_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      u0_user  =  0._rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION u0_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Initial y velocity
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION v0_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		v0_user  =  0._rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION v0_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Inflow boundary condition
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION inflow_user( t , x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  t , x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		inflow_user  =  0.0_rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION inflow_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Outflow boundary condition
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION outflow_user( t , x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  t , x , y
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		outflow_user  =  0.0_rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION outflow_user
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Test Constants
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION om( a , h0 )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  a , h0
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      om  =  sqrt( 8._rp * g * h0 / a**2 )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION om
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION s( om , tau )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  om , tau
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      s  =  demi * sqrt( om**2 - tau**2 )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION s
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Exact water elevation
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION zs_exact( x , y , t )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y , t
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      real(rp)  ::  tau , ss , xx
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      xx   =  x - demi * lx
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      tau  =  manning_user( xx , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      ss   =  s( om( a , h0 ) , tau )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs_exact  =  ( a**2 * b**2 * exp( - tau * t ) ) / ( 8._rp * g**2 *
 h0 )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs_exact  =  zs_exact * ( - ss * tau * sin( two * ss * t ) + &
\end_layout

\begin_layout Plain Layout

                                ( d1p4 * tau**2 - ss**2 ) * cos( two * ss
 * t ) )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs_exact  =  zs_exact - ( b**2 * exp( - tau * t ) ) / ( 4._rp * g )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs_exact  =  zs_exact - exp( - demi * tau * t ) * &
\end_layout

\begin_layout Plain Layout

                              b * ( ss * cos( ss * t ) + tau * demi * sin(
 ss * t ) ) * xx / g
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      zs_exact  =  zs_exact + h0
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION zs_exact
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Exact x velocity
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION u_exact( x , y , t )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y , t
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      real(rp)  ::  tau , ss
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      tau  =  manning_user( x , y )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      ss   =  s( om( a , h0 ) , tau )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      u_exact  =  b * exp( - demi * tau * t ) * sin( ss * t )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION u_exact
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Exact y velocity
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	real(rp) FUNCTION v_exact( x , y , t )
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      implicit none
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

		real(rp), intent(in)  ::  x , y , t
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

      v_exact  =  0._rp
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	END FUNCTION v_exact
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

END MODULE m_user_data
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
usr{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-bc"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Number of boundary conditions
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

4
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  List of boundary conditions
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

1	discharg1	file
\end_layout

\begin_layout Plain Layout

2	discharg1	file
\end_layout

\begin_layout Plain Layout

3	transm
\end_layout

\begin_layout Plain Layout

4	transm
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bc
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-hydro"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Number of hydrograph
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

2
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  First hydrograph
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

3
\end_layout

\begin_layout Plain Layout

    0				10
\end_layout

\begin_layout Plain Layout

    50000           12
\end_layout

\begin_layout Plain Layout

    100000			20
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Second hydrograph
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

3
\end_layout

\begin_layout Plain Layout

    0				50
\end_layout

\begin_layout Plain Layout

    50000           80
\end_layout

\begin_layout Plain Layout

    100000			100
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hydro{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-rat"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Number of ratcurve
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

1
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  First rating curve
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

2	0.0
\end_layout

\begin_layout Plain Layout

0.		 0.0
\end_layout

\begin_layout Plain Layout

7.		10.0
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Second rating curve
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

2	0.0
\end_layout

\begin_layout Plain Layout

0.		 0.0
\end_layout

\begin_layout Plain Layout

7.		10.0
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
rat{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-landuse"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  Number of Land Uses
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

5
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  List of Land Uses
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

1	0.1
\end_layout

\begin_layout Plain Layout

2	0.3
\end_layout

\begin_layout Plain Layout

3	0.2
\end_layout

\begin_layout Plain Layout

4	0.1
\end_layout

\begin_layout Plain Layout

5	0.1
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
landuse{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Example of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file
\begin_inset CommandInset label
LatexCommand label
name "subsec:Example-of-obs"

\end_inset


\end_layout

\begin_layout Standard
\noindent
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},commentstyle={\color{mygreen}},extendedchars=true,frame=single,keywordstyle={\color{blue}},language=Fortran,stringstyle={\color{mymauve}},tabsize=4"
inline false
status collapsed

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

!  File Defining Stations and/or Sections to output Result Files at a prescribed
 temporal frequency
\end_layout

\begin_layout Plain Layout

!===============================================================================
============================!
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

stations	2
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

400.	50.		60.
\end_layout

\begin_layout Plain Layout

600.	50.		60.
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

sections	2
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

0.		50.		1000.	50.		100		60.
\end_layout

\begin_layout Plain Layout

500.	0.		500.	100.	100		60.
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
The 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
obs{}
\end_layout

\end_inset

 file.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "references"
options "plain"

\end_inset


\end_layout

\end_body
\end_document
